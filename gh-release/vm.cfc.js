"use strict";var t=require("zlib"),e=require("crypto"),n=require("path"),r=require("fs"),o=require("json5"),i=require("got");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function s(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var c=s(e),u=s(n),f=s(r),l=s(o),d=a(i);var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},g=function(t){return t&&t.Math==Math&&t},m=g("object"==typeof globalThis&&globalThis)||g("object"==typeof window&&window)||g("object"==typeof self&&self)||g("object"==typeof p&&p)||function(){return this}()||Function("return this")(),h={},y=function(t){try{return!!t()}catch(t){return!0}},_=!y((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),w=!y((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),v=w,b=Function.prototype.call,$=v?b.bind(b):function(){return b.apply(b,arguments)},T={},S={}.propertyIsEnumerable,I=Object.getOwnPropertyDescriptor,O=I&&!S.call({1:2},1);T.f=O?function(t){var e=I(this,t);return!!e&&e.enumerable}:S;var C,E,k=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},P=w,x=Function.prototype,L=x.bind,U=x.call,A=P&&L.bind(U,U),R=P?function(t){return t&&A(t)}:function(t){return t&&function(){return U.apply(t,arguments)}},j=R,N=j({}.toString),B=j("".slice),D=function(t){return B(N(t),8,-1)},M=y,F=D,G=Object,q=R("".split),H=M((function(){return!G("z").propertyIsEnumerable(0)}))?function(t){return"String"==F(t)?q(t,""):G(t)}:G,z=TypeError,K=function(t){if(null==t)throw z("Can't call method on "+t);return t},J=H,Y=K,W=function(t){return J(Y(t))},Q=function(t){return"function"==typeof t},V=Q,X=function(t){return"object"==typeof t?null!==t:V(t)},Z=m,tt=Q,et=function(t){return tt(t)?t:void 0},nt=function(t,e){return arguments.length<2?et(Z[t]):Z[t]&&Z[t][e]},rt=R({}.isPrototypeOf),ot=m,it=nt("navigator","userAgent")||"",at=ot.process,st=ot.Deno,ct=at&&at.versions||st&&st.version,ut=ct&&ct.v8;ut&&(E=(C=ut.split("."))[0]>0&&C[0]<4?1:+(C[0]+C[1])),!E&&it&&(!(C=it.match(/Edge\/(\d+)/))||C[1]>=74)&&(C=it.match(/Chrome\/(\d+)/))&&(E=+C[1]);var ft=E,lt=y,dt=!!Object.getOwnPropertySymbols&&!lt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ft&&ft<41})),pt=dt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,gt=nt,mt=Q,ht=rt,yt=Object,_t=pt?function(t){return"symbol"==typeof t}:function(t){var e=gt("Symbol");return mt(e)&&ht(e.prototype,yt(t))},wt=String,vt=function(t){try{return wt(t)}catch(t){return"Object"}},bt=Q,$t=vt,Tt=TypeError,St=function(t){if(bt(t))return t;throw Tt($t(t)+" is not a function")},It=St,Ot=function(t,e){var n=t[e];return null==n?void 0:It(n)},Ct=$,Et=Q,kt=X,Pt=TypeError,xt={exports:{}},Lt=m,Ut=Object.defineProperty,At=function(t,e){try{Ut(Lt,t,{value:e,configurable:!0,writable:!0})}catch(n){Lt[t]=e}return e},Rt=At,jt=m["__core-js_shared__"]||Rt("__core-js_shared__",{}),Nt=jt;(xt.exports=function(t,e){return Nt[t]||(Nt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.23.1",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Bt=K,Dt=Object,Mt=function(t){return Dt(Bt(t))},Ft=Mt,Gt=R({}.hasOwnProperty),qt=Object.hasOwn||function(t,e){return Gt(Ft(t),e)},Ht=R,zt=0,Kt=Math.random(),Jt=Ht(1..toString),Yt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Jt(++zt+Kt,36)},Wt=m,Qt=xt.exports,Vt=qt,Xt=Yt,Zt=dt,te=pt,ee=Qt("wks"),ne=Wt.Symbol,re=ne&&ne.for,oe=te?ne:ne&&ne.withoutSetter||Xt,ie=function(t){if(!Vt(ee,t)||!Zt&&"string"!=typeof ee[t]){var e="Symbol."+t;Zt&&Vt(ne,t)?ee[t]=ne[t]:ee[t]=te&&re?re(e):oe(e)}return ee[t]},ae=$,se=X,ce=_t,ue=Ot,fe=function(t,e){var n,r;if("string"===e&&Et(n=t.toString)&&!kt(r=Ct(n,t)))return r;if(Et(n=t.valueOf)&&!kt(r=Ct(n,t)))return r;if("string"!==e&&Et(n=t.toString)&&!kt(r=Ct(n,t)))return r;throw Pt("Can't convert object to primitive value")},le=TypeError,de=ie("toPrimitive"),pe=function(t,e){if(!se(t)||ce(t))return t;var n,r=ue(t,de);if(r){if(void 0===e&&(e="default"),n=ae(r,t,e),!se(n)||ce(n))return n;throw le("Can't convert object to primitive value")}return void 0===e&&(e="number"),fe(t,e)},ge=_t,me=function(t){var e=pe(t,"string");return ge(e)?e:e+""},he=X,ye=m.document,_e=he(ye)&&he(ye.createElement),we=function(t){return _e?ye.createElement(t):{}},ve=we,be=!_&&!y((function(){return 7!=Object.defineProperty(ve("div"),"a",{get:function(){return 7}}).a})),$e=_,Te=$,Se=T,Ie=k,Oe=W,Ce=me,Ee=qt,ke=be,Pe=Object.getOwnPropertyDescriptor;h.f=$e?Pe:function(t,e){if(t=Oe(t),e=Ce(e),ke)try{return Pe(t,e)}catch(t){}if(Ee(t,e))return Ie(!Te(Se.f,t,e),t[e])};var xe={},Le=_&&y((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ue=X,Ae=String,Re=TypeError,je=function(t){if(Ue(t))return t;throw Re(Ae(t)+" is not an object")},Ne=_,Be=be,De=Le,Me=je,Fe=me,Ge=TypeError,qe=Object.defineProperty,He=Object.getOwnPropertyDescriptor;xe.f=Ne?De?function(t,e,n){if(Me(t),e=Fe(e),Me(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=He(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return qe(t,e,n)}:qe:function(t,e,n){if(Me(t),e=Fe(e),Me(n),Be)try{return qe(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Ge("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var ze=xe,Ke=k,Je=_?function(t,e,n){return ze.f(t,e,Ke(1,n))}:function(t,e,n){return t[e]=n,t},Ye={exports:{}},We=_,Qe=qt,Ve=Function.prototype,Xe=We&&Object.getOwnPropertyDescriptor,Ze=Qe(Ve,"name"),tn={EXISTS:Ze,PROPER:Ze&&"something"===function(){}.name,CONFIGURABLE:Ze&&(!We||We&&Xe(Ve,"name").configurable)},en=Q,nn=jt,rn=R(Function.toString);en(nn.inspectSource)||(nn.inspectSource=function(t){return rn(t)});var on,an,sn,cn=nn.inspectSource,un=Q,fn=cn,ln=m.WeakMap,dn=un(ln)&&/native code/.test(fn(ln)),pn=xt.exports,gn=Yt,mn=pn("keys"),hn=function(t){return mn[t]||(mn[t]=gn(t))},yn={},_n=dn,wn=m,vn=R,bn=X,$n=Je,Tn=qt,Sn=jt,In=hn,On=yn,Cn=wn.TypeError,En=wn.WeakMap;if(_n||Sn.state){var kn=Sn.state||(Sn.state=new En),Pn=vn(kn.get),xn=vn(kn.has),Ln=vn(kn.set);on=function(t,e){if(xn(kn,t))throw new Cn("Object already initialized");return e.facade=t,Ln(kn,t,e),e},an=function(t){return Pn(kn,t)||{}},sn=function(t){return xn(kn,t)}}else{var Un=In("state");On[Un]=!0,on=function(t,e){if(Tn(t,Un))throw new Cn("Object already initialized");return e.facade=t,$n(t,Un,e),e},an=function(t){return Tn(t,Un)?t[Un]:{}},sn=function(t){return Tn(t,Un)}}var An={set:on,get:an,has:sn,enforce:function(t){return sn(t)?an(t):on(t,{})},getterFor:function(t){return function(e){var n;if(!bn(e)||(n=an(e)).type!==t)throw Cn("Incompatible receiver, "+t+" required");return n}}},Rn=y,jn=Q,Nn=qt,Bn=_,Dn=tn.CONFIGURABLE,Mn=cn,Fn=An.enforce,Gn=An.get,qn=Object.defineProperty,Hn=Bn&&!Rn((function(){return 8!==qn((function(){}),"length",{value:8}).length})),zn=String(String).split("String"),Kn=Ye.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Nn(t,"name")||Dn&&t.name!==e)&&qn(t,"name",{value:e,configurable:!0}),Hn&&n&&Nn(n,"arity")&&t.length!==n.arity&&qn(t,"length",{value:n.arity});try{n&&Nn(n,"constructor")&&n.constructor?Bn&&qn(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=Fn(t);return Nn(r,"source")||(r.source=zn.join("string"==typeof e?e:"")),t};Function.prototype.toString=Kn((function(){return jn(this)&&Gn(this).source||Mn(this)}),"toString");var Jn=Q,Yn=xe,Wn=Ye.exports,Qn=At,Vn={},Xn=Math.ceil,Zn=Math.floor,tr=Math.trunc||function(t){var e=+t;return(e>0?Zn:Xn)(e)},er=function(t){var e=+t;return e!=e||0===e?0:tr(e)},nr=er,rr=Math.max,or=Math.min,ir=er,ar=Math.min,sr=function(t){return t>0?ar(ir(t),9007199254740991):0},cr=function(t){return sr(t.length)},ur=W,fr=function(t,e){var n=nr(t);return n<0?rr(n+e,0):or(n,e)},lr=cr,dr=function(t){return function(e,n,r){var o,i=ur(e),a=lr(i),s=fr(r,a);if(t&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},pr={includes:dr(!0),indexOf:dr(!1)},gr=qt,mr=W,hr=pr.indexOf,yr=yn,_r=R([].push),wr=function(t,e){var n,r=mr(t),o=0,i=[];for(n in r)!gr(yr,n)&&gr(r,n)&&_r(i,n);for(;e.length>o;)gr(r,n=e[o++])&&(~hr(i,n)||_r(i,n));return i},vr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],br=wr,$r=vr.concat("length","prototype");Vn.f=Object.getOwnPropertyNames||function(t){return br(t,$r)};var Tr={};Tr.f=Object.getOwnPropertySymbols;var Sr=nt,Ir=Vn,Or=Tr,Cr=je,Er=R([].concat),kr=Sr("Reflect","ownKeys")||function(t){var e=Ir.f(Cr(t)),n=Or.f;return n?Er(e,n(t)):e},Pr=qt,xr=kr,Lr=h,Ur=xe,Ar=function(t,e,n){for(var r=xr(e),o=Ur.f,i=Lr.f,a=0;a<r.length;a++){var s=r[a];Pr(t,s)||n&&Pr(n,s)||o(t,s,i(e,s))}},Rr=y,jr=Q,Nr=/#|\.prototype\./,Br=function(t,e){var n=Mr[Dr(t)];return n==Gr||n!=Fr&&(jr(e)?Rr(e):!!e)},Dr=Br.normalize=function(t){return String(t).replace(Nr,".").toLowerCase()},Mr=Br.data={},Fr=Br.NATIVE="N",Gr=Br.POLYFILL="P",qr=Br,Hr=m,zr=h.f,Kr=Je,Jr=function(t,e,n,r){r||(r={});var o=r.enumerable,i=void 0!==r.name?r.name:e;return Jn(n)&&Wn(n,i,r),r.global?o?t[e]=n:Qn(e,n):(r.unsafe?t[e]&&(o=!0):delete t[e],o?t[e]=n:Yn.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})),t},Yr=At,Wr=Ar,Qr=qr,Vr=function(t,e){var n,r,o,i,a,s=t.target,c=t.global,u=t.stat;if(n=c?Hr:u?Hr[s]||Yr(s,{}):(Hr[s]||{}).prototype)for(r in e){if(i=e[r],o=t.dontCallGetSet?(a=zr(n,r))&&a.value:n[r],!Qr(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Wr(i,o)}(t.sham||o&&o.sham)&&Kr(i,"sham",!0),Jr(n,r,i,t)}},Xr=w,Zr=Function.prototype,to=Zr.apply,eo=Zr.call,no="object"==typeof Reflect&&Reflect.apply||(Xr?eo.bind(to):function(){return eo.apply(to,arguments)}),ro=Q,oo=String,io=TypeError,ao=R,so=je,co=function(t){if("object"==typeof t||ro(t))return t;throw io("Can't set "+oo(t)+" as a prototype")},uo=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=ao(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return so(n),co(r),e?t(n,r):n.__proto__=r,n}}():void 0),fo=xe.f,lo=Q,po=X,go=uo,mo={};mo[ie("toStringTag")]="z";var ho="[object z]"===String(mo),yo=Q,_o=D,wo=ie("toStringTag"),vo=Object,bo="Arguments"==_o(function(){return arguments}()),$o=ho?_o:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=vo(t),wo))?n:bo?_o(e):"Object"==(r=_o(e))&&yo(e.callee)?"Arguments":r},To=$o,So=String,Io=function(t){if("Symbol"===To(t))throw TypeError("Cannot convert a Symbol value to a string");return So(t)},Oo=function(t,e){return void 0===t?arguments.length<2?"":e:Io(t)},Co=X,Eo=Je,ko=function(t,e){Co(e)&&"cause"in e&&Eo(t,"cause",e.cause)},Po=Error,xo=R("".replace),Lo=String(Po("zxcasd").stack),Uo=/\n\s*at [^:]*:[^\n]*/,Ao=Uo.test(Lo),Ro=function(t,e){if(Ao&&"string"==typeof t&&!Po.prepareStackTrace)for(;e--;)t=xo(t,Uo,"");return t},jo=k,No=!y((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",jo(1,7)),7!==t.stack)})),Bo=nt,Do=qt,Mo=Je,Fo=rt,Go=uo,qo=Ar,Ho=function(t,e,n){n in t||fo(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})},zo=function(t,e,n){var r,o;return go&&lo(r=e.constructor)&&r!==n&&po(o=r.prototype)&&o!==n.prototype&&go(t,o),t},Ko=Oo,Jo=ko,Yo=Ro,Wo=No,Qo=_,Vo=Vr,Xo=no,Zo=function(t,e,n,r){var o="stackTraceLimit",i=r?2:1,a=t.split("."),s=a[a.length-1],c=Bo.apply(null,a);if(c){var u=c.prototype;if(Do(u,"cause")&&delete u.cause,!n)return c;var f=Bo("Error"),l=e((function(t,e){var n=Ko(r?e:t,void 0),o=r?new c(t):new c;return void 0!==n&&Mo(o,"message",n),Wo&&Mo(o,"stack",Yo(o.stack,2)),this&&Fo(u,this)&&zo(o,this,l),arguments.length>i&&Jo(o,arguments[i]),o}));l.prototype=u,"Error"!==s?Go?Go(l,f):qo(l,f,{name:!0}):Qo&&o in c&&(Ho(l,c,o),Ho(l,c,"prepareStackTrace")),qo(l,c);try{u.name!==s&&Mo(u,"name",s),u.constructor=l}catch(t){}return l}},ti=m.WebAssembly,ei=7!==Error("e",{cause:7}).cause,ni=function(t,e){var n={};n[t]=Zo(t,e,ei),Vo({global:!0,constructor:!0,arity:1,forced:ei},n)},ri=function(t,e){if(ti&&ti[t]){var n={};n[t]=Zo("WebAssembly."+t,e,ei),Vo({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:ei},n)}};function oi(e){try{const n=t.unzipSync(Buffer.from(e,"base64")).toString();try{return decodeURIComponent(ii(n))}catch(t){return unescape(n)}}catch(t){throw new Error("Error: å½“å‰å­—ç¬¦ä¸²ä¸èƒ½è¢«Gzipè§£å‹")}}function ii(t){return t.replace(/\\u([\d\w]{4})/gi,((t,e)=>String.fromCodePoint(parseInt(e,16))))}ni("Error",(function(t){return function(e){return Xo(t,this,arguments)}})),ni("EvalError",(function(t){return function(e){return Xo(t,this,arguments)}})),ni("RangeError",(function(t){return function(e){return Xo(t,this,arguments)}})),ni("ReferenceError",(function(t){return function(e){return Xo(t,this,arguments)}})),ni("SyntaxError",(function(t){return function(e){return Xo(t,this,arguments)}})),ni("TypeError",(function(t){return function(e){return Xo(t,this,arguments)}})),ni("URIError",(function(t){return function(e){return Xo(t,this,arguments)}})),ri("CompileError",(function(t){return function(e){return Xo(t,this,arguments)}})),ri("LinkError",(function(t){return function(e){return Xo(t,this,arguments)}})),ri("RuntimeError",(function(t){return function(e){return Xo(t,this,arguments)}}));var ai=xe.f,si=qt,ci=ie("toStringTag"),ui=m,fi=function(t,e,n){t&&!n&&(t=t.prototype),t&&!si(t,ci)&&ai(t,ci,{configurable:!0,value:e})};Vr({global:!0},{Reflect:{}}),fi(ui.Reflect,"Reflect",!0);const li=()=>process.env.QL_BRANCH;function di(){return global.IS_CFC||!0}function pi(){return global.IS_CFC||!1}function gi(){const t=li()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}function mi(){const t=Object.keys(process.env),e=["securityToken","accessKeyID","accessKeySecret","FC_FUNCTION_MEMORY_SIZE","FC_FUNC_CODE_PATH","FC_RUNTIME_VERSION"];return t.filter((t=>e.includes(t))).length>=3||!1}function hi(){const t=Object.keys(process.env),e=t.filter((t=>t.startsWith("SCF_"))).length>=10,n=t.filter((t=>t.startsWith("TENCENTCLOUD_"))).length>=3;return e&&n||!1}function yi(){return hi()||mi()||pi()||di()}const _i=["æ£’","æ£’å”‰","æ£’è€¶","åŠ æ²¹~","UPåŠ æ²¹!","æ”¯æŒ~","æ”¯æŒæ”¯æŒï¼","å‚¬æ›´å•¦","é¡¶é¡¶","ç•™ä¸‹è„šå°~","å¹²æ¯","bilibiliå¹²æ¯","o(*ï¿£â–½ï¿£*)o","(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾å—¨","(â—Ë‡âˆ€Ë‡â—)","( â€¢Ì€ Ï‰ â€¢Ì )y","(à¸‡ â€¢_â€¢)à¸‡",">.<","^_~"],wi=Object.prototype.toString;function vi(t,e){return wi.call(t)===`[object ${e}]`}function bi(t){return void 0!==t}function $i(t){return!bi(t)}function Ti(t){return null!==t&&vi(t,"Object")}function Si(t){return null===t}function Ii(t){return vi(t,"Number")}function Oi(t){return vi(t,"String")}function Ci(t){return"function"==typeof t}function Ei(t){return t&&Array.isArray(t)}const ki="undefined"==typeof window,Pi=!ki;function xi(t){const e=t||Ui(),n=e.getFullYear(),r=e.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}function Li(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=c.randomBytes(1)[0]%16;return("x"===t?e:3&e|8).toString(16)}))}function Ui(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function Ai(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}function Ri(t,e){return Math.ceil(e/t)}function ji(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}function Ni({hours:t,minutes:e,seconds:n},r){let o;switch(n=n||0,r){case"scf":default:o=`${n} ${e} ${t} * * * *`;break;case"fc":o=`${n} ${e} ${t} * * *`;break;case"cfc":o=`corn(${e} ${t} * * *)`}return{value:o,string:`${t}:${e}:${n}`}}function Bi(t,e){let n="";for(let e=0;e<t;e++)n+=zi("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return e?n.toLowerCase():n}function Di(){return`${ji(1,9)}${Bi(10,!0)}0`}function Mi(t,e){t.includes(e)||t.push(e)}function Fi(t){return t||{}}function Gi(t,e=!1){return Ti(t)?Array.isArray(t)?t.map((t=>Gi(t,e))):e?Object.keys(t).reduce(((n,r)=>(n[r]=Gi(t[r],e),n)),{}):Object.assign({},t):t}function qi(t,e){return void 0===t||void 0===e?t||e:Ti(t)&&Ti(e)?Array.isArray(t)&&Array.isArray(e)?t.concat(e):Object.keys(e).reduce(((n,r)=>(n[r]=qi(t[r],e[r]),n)),t):e}function Hi(t){if(!Ti(t)&&!Ei(t))return t;const e=new URLSearchParams;return Array.isArray(t)||(t=Object.entries(t)),t.forEach((([t,n])=>{Ti(n)?e.append(t,JSON.stringify(n)):e.append(t,String(n))})),e.toString()}function zi(t){return t[ji(t.length-1)]}function Ki(t={},e={}){function n(t){return Object.keys(t).reduce(((e,n)=>(e[n.toLowerCase()]=t[n],e)),{})}return Object.assign({},n(t),n(e))}function Ji(t){return t&&t.map((t=>Number(t))).filter((t=>t>0&&t%1==0))}function Yi(t,e=!0){return e?t.toLocaleString("zh-CN",{hour12:!1}):t.toLocaleString("zh-CN",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"})}function Wi(t="info"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return-1!==n?e.slice(0,n+1):e}function Qi(t){return u.resolve(process.cwd(),t)}class Vi{static pushValue="";static brChar="\n";month=Ui().getMonth()+1;errorFile=Qi(`./logs/bt_error-${this.month}.log`);logFile=Qi(`./logs/bt_combined-${this.month}.log`);noFile=!1;constructor(t={console:"info",file:"info",push:"info"},e="default"){this.options=t,this.name=e,this.consoleLeval=Wi(this.options.console),this.fileLeval=Wi(this.options.file),this.pushLeval=Wi(this.options.push),this.noFile=li()||yi(),this.noFile||this.createLogFile()}log({level:t},e,n){n=n||Zi[t];const r=Ui(),o=`[${n} ${Yi(r,!1)}] ${e}\n`,i=["error","warn"].includes(t);this.consoleLeval.includes(t)&&this.Conslole(o,i),!this.noFile&&this.fileLeval.includes(t)&&this.File(`[${n} ${Yi(r,!0)}] ${e}\n`,i),this.pushLeval.includes(t)&&this.Push(`[${n} ${Yi(r,!1)}] ${e}${Vi.brChar}`)}error(t){this.log({level:"error"},t)}warn(t){this.log({level:"warn"},t)}info(t,e){this.log({level:"info"},t,e)}verbose(t){this.log({level:"verbose"},t)}debug(t){this.log({level:"debug"},t)}Conslole(t,e){e?process.stderr.write(t):process.stdout.write(t)}File(t,e){e&&f.appendFileSync(this.errorFile,t,"utf-8"),f.appendFileSync(this.logFile,t,"utf-8")}Push(t){Vi.pushValue+=t}createLogFile(){const t=Qi("./logs");f.existsSync(t)||f.mkdirSync(t)}static async init(){Vi.pushValue="";try{const{TaskConfig:t}=await Promise.resolve().then((function(){return Ia}));Vi.brChar=t.message.br||"\n"}catch{}}}const Xi=new Vi({console:"debug",file:"debug",push:"debug"}),Zi={error:"â“",warn:"â”",info:"ğŸ‘»",verbose:"ğŸ’¬",debug:"ğŸ›"};class ta{static configFileName=gi();static isQingLongPanel=li()}const ea=l.default?l.default:l;function na(t){try{let e;if((r.existsSync(t)||r.existsSync(t+="5"))&&(e=r.readFileSync(t,"utf-8")),!e)return;return ea.parse(e)}catch(t){Xi.error(t),function(t){if(!Oi(t))return;if(t.includes("SyntaxError: JSON5"))throw new SyntaxError("é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯æ— æ³•è§£æï¼å¯èƒ½ JSON5 æ ¼å¼ä¸æ­£ç¡®ï¼");throw new Error(t)}(t.message)}}const ra=t=>u.resolve(process.cwd(),t),oa=t=>u.resolve(__dirname,"../",t),ia=Array.from(new Set([ra("./config/config.dev.json"),ra(`./config/${ta.configFileName}`),ra(`./${ta.configFileName}`),oa(`./config/${ta.configFileName}`),oa(`./${ta.configFileName}`)])),aa=["./config.json",ra("./config/config.json")];function sa(t){let e;const n=Array.isArray(t);if(e=n?t:t.account.filter((t=>t.cookie)),0===e.length)return;if(ta.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(Xi.warn("ä¼¼ä¹æƒ³è¦æŒ‡å®šä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†æŒ‡å®šç¬¬ä¸€ä¸ªç”¨æˆ·"),t[0]):t[n]}(e);Xi.warn("åœ¨å•ç”¨æˆ·åœºæ™¯ä¸‹é…ç½®äº†å¤šç”¨æˆ·ï¼Œæˆ‘ä»¬å°†æ”¾å¼ƒå¤šä½™çš„é…ç½®");const r=e[0];return n||(r.message=Object.assign(t.message||{},r.message)),r}function ca(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;ta.isQingLongPanel&&ia.splice(0,1,...aa);for(let t=0;t<ia.length;t++){const e=na(ia[t]);if(e)return Xi.verbose(`è¯»å–é…ç½®æ–‡ä»¶ ${ia[t]}`),e}return(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,r=t||e||n;if(r)try{return ea.parse(oi(r))}catch(t){throw Xi.error(t),new Error("ç¯å¢ƒä¸­çš„é…ç½®ä¸æ˜¯æœ‰æ•ˆçš„ JSON å­—ç¬¦ä¸²ï¼")}})()}function ua(t){return fa(ca(),t)}function fa(t,e=!1){if(!t)throw new Error("è·å–é…ç½®å¤±è´¥ï¼æœªæ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼");if(e)return function(t){const e=t=>t.cookie&&t.cookie.length>90&&["bili_jct","SESSDATA","DedeUserID"].every((e=>t.cookie.includes(e)));if(Array.isArray(t))return t.filter(e);return t.account.filter(e)}(la(t)?t:[t]);if(la(t)){const e=sa(t);if(e)return e}if(!t.cookie)throw new Error("é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰ cookieï¼");return t}function la(t){return!!Array.isArray(t)||Boolean(t.account&&t.account.length)}function da(t){return t?t.split("; ").map((t=>t.split("="))):[]}function pa(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=da(null==e?void 0:e[0]).filter((t=>2===t.length)),r=da(t).concat(n).filter((t=>2===t.length)),o={};for(const t of r)o[t[0]]?o[t[0]]=t[1]:Object.defineProperty(o,t[0],{value:t[1],enumerable:!0,writable:!0});return o}(t,e)):t:""}function ga(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,r=t.match(n);return r?r[1]:null}function ma(t){return Number(ga(t,"DedeUserID"))||0}function ha(t){return ga(t,"bili_jct")||""}const ya={cookie:"",message:{br:"\n",email:{host:"smtp.163.com",port:465},pushplusToken:process.env.PUSHPLUS_TOKEN,api:{method:"POST",headers:{"Content-Type":"application/json"},timeout:5e3,url:"",proxy:{host:"",port:443,auth:""},data:{}}},function:{silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1,liveRedPack:!1,liveIntimacy:!1,mangaTask:!1},apiDelay:[2,6],userAgent:"",dailyRunTime:"17:30:00-23:40:00",targetLevel:void 0,stayCoins:void 0,targetCoins:void 0,customizeUp:void 0,giftUp:void 0,coinRetryNum:void 0,chargeUpId:void 0,chargePresetTime:void 0,matchCoins:void 0,matchSelection:void 0,matchDiff:void 0,match:{coins:5,selection:1,diff:0},charge:{mid:0,presetTime:[10,20]},gift:{mids:[]},coin:{customizeUp:[],retryNum:4,targetLevel:6,stayCoins:0,targetCoins:5},sls:{name:"",description:"",region:"ap-chengdu",dailyRunTime:"17:30:00-23:40:00"},lottery:{excludeAward:["èˆ°","èˆ¹","èˆªæµ·","ä»£é‡‘åˆ¸","ä¼˜æƒ åˆ¸","è‡ªæ‹","ç…§","å†™çœŸ","å›¾","æç£","è½¦è½¦ä¸€å±€","å†æ¥ä¸€å±€","æ¸¸æˆé“å…·"],includeAward:["è°¢"],blackUid:[65566781,1277481241,1643654862,603676925],isMoveTag:!0,moveTag:"å¤©é€‰æ—¶åˆ»",pageNum:2,actFollowMsg:"read",scanFollow:void 0,skipNeedFollow:!1},redPack:{},intimacy:{liveSendMessage:!0,liveShare:!0,liveLike:!0,liveHeart:!1,whiteList:[],blackList:[]},manga:{sign:!0,buy:!1,mc:[],name:[],love:!0,buyInterval:6,buyWeek:[3]},BILIJCT:"",USERID:0};function _a(t){return function(t){!function(t){t.BILIJCT=ha(t.cookie),t.USERID=ma(t.cookie)}(t);const{coin:e,gift:n,charge:r}=t;Ei(t.apiDelay)?t.apiDelay=Ji(t.apiDelay):t.apiDelay=[Number(t.apiDelay)];e.customizeUp=Ji(e.customizeUp),n.mids=Ji(n.mids),0===n.mids.length&&(n.mids=e.customizeUp);r.mid||(r.mid=t.USERID);return t}(function(t){return Object.keys(wa).forEach((e=>{if(void 0!==t[e]){const[n,r]=wa[e];t[n]=Fi(t[n]),t[n][r]=t[e]}delete t[e]})),t}(qi(Gi(ya,!0),function(t){const{message:e}=t;if(e&&Oi(e.api)){const t=e.api;e.api=Gi(ya.message.api,!0),e.api.url=t,e.api.method="GET"}return t}(t))))}const wa={targetLevel:["coin","targetLevel"],stayCoins:["coin","stayCoins"],targetCoins:["coin","targetCoins"],customizeUp:["coin","customizeUp"],coinRetryNum:["coin","retryNum"],giftUp:["gift","mids"],chargeUpId:["charge","mid"],chargePresetTime:["charge","presetTime"],matchCoins:["match","coins"],matchSelection:["match","selection"],matchDiff:["match","diff"]};class va{constructor(t){this.COOKIE=t.cookie,this.BILIJCT=t.BILIJCT,this.USERID=t.USERID,this.USER_AGENT=t.userAgent,this.BILI_API_DELAY=t.apiDelay;const e=t.message;this.PUSHPLUS_TOKEN=e.pushplusToken;const n=t.coin;this.BILI_CUSTOMIZE_UP=n.customizeUp,this.BILI_COIN_RETRY_NUM=n.retryNum,this.BILI_TARGET_LEVEL=n.targetLevel,this.BILI_STAY_COINS=n.stayCoins,this.BILI_TARGET_COINS=n.targetCoins;const r=t.gift;this.BILI_GIFT_UP=r.mids;const o=t.match;this.MATCH_COINS=o.coins,this.MATCH_SELECTION=o.selection,this.MATCH_DIFF=o.diff}}let ba;const $a=new Proxy({},{get:(t,e)=>(ba||Sa(),Reflect.get(ba,e)),set:(t,e,n)=>"config"===e&&n?(Sa(n),!0):Reflect.set(ba,e,n)});let Ta=null;function Sa(t){t||(t=ua(!1));const e=_a(t);ba={...new va(fa(e)),...e},Ta=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static vipStatus=0;static userLevel=0}{},Ta.coinsTask=ba.BILI_TARGET_COINS}var Ia=Object.freeze({__proto__:null,TaskConfig:$a,get TaskModule(){return Ta},initialize:Sa,changeConfig:function(t){const e=ua();e[t]&&Sa(e[t])}});function Oa(t,e){const n=Ea(t,e);return new Promise((t=>{setTimeout((()=>{t(n)}),n)}))}function Ca(t,e){Ea(t,e)}function Ea(t,e){if(t&&e)return ji(t,e);if(t)return t;const n=$a.BILI_API_DELAY;return 1===n.length?1e3*n[0]:1e3*ji(n[0]||2,n[1]||6)}var ka=Object.freeze({__proto__:null,gzipEncode:function(e){try{return t.gzipSync(encodeURIComponent(e)).toString("base64")}catch(t){return"Error: å½“å‰å­—ç¬¦ä¸²ä¸èƒ½è¢«Gzipå‹ç¼©"}},gzipDecode:oi,unicode2str:ii,apiDelay:Oa,apiDelaySync:Ca,getCookieItem:ga,getUserId:ma,getBiliJct:ha,getLIVE_BUVID:function(t){return ga(t,"LIVE_BUVID")||""},isQingLongPanel:li,isCFC:di,isAGC:pi,setConfigFileName:gi,isFC:mi,isSCF:hi,isServerless:yi,Logger:Vi,logger:Xi,getMonthHasDays:xi,createUUID:Li,getPRCDate:Ui,jsonp2Object:Ai,getPageNum:Ri,setCron:function(t=6e4,e){t=t||6e4;const n=Ui().getTime()+t,r=new Date(n),o=r.getSeconds(),i=r.getMinutes();return Ni({hours:r.getHours(),minutes:i,seconds:o},e)},random:ji,randomDailyRunTime:function(t="17:30:00-23:40:00",e){var n,r;const o=t.split("-"),i=o[0].split(":").map((t=>+t)),a=o[1].split(":").map((t=>+t)),s=ji(null!==(n=i[0])&&void 0!==n?n:19,null!==(r=a[0])&&void 0!==r?r:23);let c=0;c=s==i[0]?ji(i[1],59):s==a[0]?ji(a[1]):ji(59);let u=0;return u=s==i[0]?ji(i[2],59):s==a[0]?ji(a[2]):ji(59),Ni({seconds:u,hours:s,minutes:c},e)},formatCron:Ni,randomString:Bi,getVisitId:Di,pushIfNotExist:Mi,getNewObject:Fi,cloneObject:Gi,deepMergeObject:qi,stringify:Hi,getRandomItem:zi,md5:function(t,e=!1){const n=c.createHash("md5");return n.update(t),e?n.digest("hex").toUpperCase():n.digest("hex")},mergeHeaders:Ki,arr2numArr:Ji,base64Encode:function(t){return Buffer.from(t).toString("base64")},isTodayInTimeArr:function(t){if(!t||!t.length)return!0;const e=(new Date).getDate();return t.includes(e)},is:vi,isDef:bi,isUnDef:$i,isObject:Ti,isEmpty:function(t){return Ei(t)||Oi(t)?0===t.length:t instanceof Map||t instanceof Set?0===t.size:!!Ti(t)&&0===Object.keys(t).length},isDate:function(t){return vi(t,"Date")},isNull:Si,isNullAndUnDef:function(t){return $i(t)&&Si(t)},isNullOrUnDef:function(t){return $i(t)||Si(t)},isNumber:Ii,isPromise:function(t){return vi(t,"Promise")&&Ti(t)&&Ci(t.then)&&Ci(t.catch)},isString:Oi,isFunction:Ci,isBoolean:function(t){return vi(t,"Boolean")},isRegExp:function(t){return vi(t,"RegExp")},isArray:Ei,isWindow:function(t){return"undefined"!=typeof window&&vi(t,"Window")},isElement:function(t){return Ti(t)&&!!t.tagName},isMap:function(t){return vi(t,"Map")},isServer:ki,isClient:Pi,isUrl:function(t){return/(((^https?:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+(?::\d+)?|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)$/.test(t)},isEmail:function(t){return/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(t)}});Xi.info("å¼€å§‹æ‰§è¡Œç½‘ç»œä»£ç "),async function(t,...e){const{apiDelay:n,logger:r,Logger:o}=await Promise.resolve().then((function(){return ka})),{offFunctions:i}=await Promise.resolve().then((function(){return Pa})),{sendMessage:a}=await Promise.resolve().then((function(){return fs})),{loginTask:s,default:c}=await Promise.resolve().then((function(){return Gu})),{printVersion:u}=await Promise.resolve().then((function(){return Yf}));await o.init(),await u();try{await s()}catch(t){return r.error(`ç™»å½•å¤±è´¥: ${t}`),await a("ç™»å½•å¤±è´¥",o.pushValue),"æœªå®Œæˆ"}const f=i([...Object.values(c)]);for(const t of f)try{await t()}catch(e){r.error(`${t.name}å¤±è´¥: ${e}`)}finally{await n()}return t&&await t(...e),await a("æ¯æ—¥å®Œæˆ",o.pushValue),"å®Œæˆ"}().then((t=>{VMThis.message=t,VMThis.resolve(t)})).catch((t=>{VMThis.error=t,VMThis.reject(t)}));var Pa=Object.freeze({__proto__:null,offFunctions:function(t){const e=function(){const t=$a.function;return t.addCoins||t.shareAndWatch||(t.taskReward=!1),t.liveIntimacy&&$a.intimacy.liveSendMessage&&(t.liveSendMessage=!1),t.mangaTask&&$a.manga.sign&&(t.mangaSign=!1),t}();return t.map((t=>e[t.name]?t:null)).filter((t=>t))}});const xa="https://account.bilibili.com",La="https://live.bilibili.com",Ua="https://space.bilibili.com",Aa="https://message.bilibili.com",Ra="https://www.bilibili.com",ja="https://www.bilibili.com/",Na="https://account.bilibili.com",Ba="https://api.live.bilibili.com",Da="https://api.bilibili.com",Ma="https://manga.bilibili.com",Fa="https://api.vc.bilibili.com",Ga="https://live-trace.bilibili.com",qa={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate, br"};function Ha({version:t="6.74.0",phone:e="MI 10 Pro",build:n="6740400",channel:r="xiaomi",os:o="10"}={}){return`Mozilla/5.0 BiliDroid/${t} (bbcallen@gmail.com) os/android model/${e} mobi_app/android build/${n} channel/${r} innerVer/${r} osVer/${o} network/2`}const za=(t,e)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=e;if(r)return t;if(!1===n)return t.body;const{body:o}=t;if(e.isJsonp&&Oi(o))return Ai(o);try{if(Oi(o)&&o.startsWith("{"))return JSON.parse(o)}catch{}return o};class Ka{name="VGot";constructor(t){t.baseURL&&(t.prefixUrl=t.baseURL),this.options=t,this.gotInstance=d.default.extend(t,{hooks:{afterResponse:[t=>{const{requestOptions:e}=t.request.options;var n;null!=e&&e.withBiliCookie&&($a.COOKIE=pa($a.COOKIE,(null===(n=t.headers)||void 0===n?void 0:n["set-cookie"])||[]));return t}]}})}request(t){const{requestOptions:e={},headers:n={}}=this.options;return t.requestOptions=Object.assign({},e,t.requestOptions),t.headers=Ki(n,t.headers),e.withBiliCookie&&(t.headers.Cookie=$a.COOKIE),e.retry&&(t.retry=e.retry),t=function(t){Oi(t.url)||(t.url=t.url.toString()),Ti(t.params)&&!Oi(t.searchParams)&&(t.searchParams={...t.searchParams,...t.params});const e=t.headers["content-type"],n=null==e?void 0:e.startsWith("application/x-www-form-urlencoded");function r(e){t.agent||(t.agent={}),t.agent[e]=t[`${e}Agent`]}return Ti(t.data)&&(n?t.body=Hi(t.data):t.json=t.data),Oi(t.data)&&n&&(t.body=t.data),t.httpAgent&&r("http"),t.httpsAgent&&r("https"),t.url&&t.url.startsWith("/")&&(t.url=t.url.substring(1)),t}(t),new Promise(((e,n)=>{this.gotInstance(t).then((r=>{if(Ci(za))try{const n=za(r,t.requestOptions);e(n)}catch(t){n(t||new Error("è¯·æ±‚é”™è¯¯!"))}else e(r)})).catch((t=>{t.response&&(t.response.status=t.response.statusCode),n(t)}))}))}get(t,e){return Oi(t)?this.request({...e,method:"GET",url:t}):this.request({...t,method:"GET"})}post(t,e,n){return Oi(t)?this.request({...n,method:"POST",url:t,data:e}):this.request({...t,method:"POST"})}put(t,e,n){return this.request({...n,method:"PUT",url:t,data:e})}delete(t,e,n){return this.request({...n,method:"DELETE",url:t,data:e})}patch(t,e,n){return this.request({...n,method:"PATCH",url:t,data:e})}}function Ja(t){return new Ka(qi({timeout:1e4,headers:{"content-type":qa["content-type"],"user-agent":qa["user-agent"],"accept-language":qa["accept-language"],"accept-encoding":qa["accept-encoding"]},requestOptions:{isTransformResponse:!0,ignoreCancelToken:!0,withBiliCookie:!0}},t||{}))}const Ya=Ja({requestOptions:{withBiliCookie:!1}}),Wa=Ja();let Qa={};function Va(){const t=$a.message||{};Qa=function(t={}){return Qa.SCKEY="",Qa.BARK_PUSH="",Qa.BARK_SOUND="",Qa.BARK_GROUP="QingLong",Qa.TG_BOT_TOKEN="",Qa.TG_USER_ID="",Qa.TG_PROXY_HOST="",Qa.TG_PROXY_PORT="",Qa.TG_PROXY_AUTH="",Qa.TG_API_HOST="api.telegram.org",Qa.DD_BOT_TOKEN="",Qa.DD_BOT_SECRET="",Qa.QYWX_KEY="",Qa.QYWX_AM="",Qa.IGOT_PUSH_KEY="",Qa.PUSH_PLUS_TOKEN="",Qa.PUSH_PLUS_USER="",Qa.QQ_SKEY="",Qa.QQ_MODE="",t}(Qa),["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((e=>{const n=t[(r=e,r.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||t[e]||process.env[e];var r;n&&(Qa[e]=n)})),$a.PUSHPLUS_TOKEN&&(Qa.PUSH_PLUS_TOKEN=$a.PUSHPLUS_TOKEN)}async function Xa(t,e){var n;const r=null===(n=$a.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const{createTransport:o}=await Promise.resolve().then((function(){return s(require("nodemailer"))})),i=Number(r.port)||465,a=o({host:r.host,port:i,secure:465===i,auth:{user:r.from,pass:r.pass}}),c=await a.sendMail({from:`${t} <${r.from}>`,to:r.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e.replace(/\n/g,"\r\n")});Xi.info(`é‚®ä»¶æ¶ˆæ¯å·²å‘é€: ${c.messageId}`)}async function Za(t,e){try{const n=$a.message.api;if(!n||!n.url)return;const{data:r,proxy:o,timeout:i,headers:a}=n,c={method:n.method.toUpperCase()||"POST",timeout:i,headers:a,url:""};if(c.url=n.url.replace("{title}",encodeURIComponent(t)).replace("{text}",encodeURIComponent(e)),o.host){const t=(await Promise.resolve().then((function(){return s(require("tunnel"))}))).httpsOverHttp({proxy:{host:o.host,port:+o.port,proxyAuth:o.auth},maxSockets:1});Object.assign(c,{httpsAgent:t})}const u=Object.keys(r);u.length&&(u.forEach((n=>{"{text}"===r[n]&&(r[n]=e),"{title}"===r[n]&&(r[n]=t)})),Object.assign(c,{data:r})),await Ya.request(c),Xi.info("è‡ªå®šä¹‰æ¥å£æ¶ˆæ¯å·²å‘é€ï¼")}catch(t){Xi.info(`è‡ªå®šä¹‰æ¥å£æ¶ˆæ¯å‘é€å¤±è´¥: ${t}`),Xi.error(t)}}function ts(t,e,n=2100){return new Promise((r=>{const o=Qa.SCKEY;if(o){e=e.replace(/[\n\r]/g,"\n\n");const i={url:o.includes("SCT")?`https://sctapi.ftqq.com/${o}.send`:`https://sc.ftqq.com/${o}.send`,data:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{Ya.post(i).then((t=>{0===t.errno||0===t.data.errno?Xi.info("serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰"):1024===t.errno?Xi.info(`serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯å¼‚å¸¸: ${t.errmsg}`):Xi.info(`serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯å¼‚å¸¸\n${JSON.stringify(t)}`)})).catch((t=>{Xi.info("serveré…±å‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼"),Xi.info(t)})).finally((()=>{r("")}))}),n)}else r("")}))}function es(t,e){return new Promise((n=>{const{QQ_SKEY:r,QQ_MODE:o}=Qa;if(r){const i={url:`https://push.xuthus.cc/${o}/${r}`,headers:{"Content-Type":"application/json"},data:{},params:{}};t=t.replace(/äº¬è±†/g,"è±†è±†"),e=(e=(e=e.replace(/äº¬è±†/g,"")).replace(/ğŸ¶/g,"")).replace(/çº¢åŒ…/g,"HåŒ…"),i.data="email"===o?{t:t,c:e}:`${t}\n\n${e}`;const a=function(t){switch(t){case"send":return"ä¸ªäºº";case"group":return"QQç¾¤";case"wx":return"å¾®ä¿¡";case"ww":return"ä¼ä¸šå¾®ä¿¡";case"email":return"é‚®ä»¶";default:return"æœªçŸ¥æ–¹å¼"}};Ya.post(i).then((t=>{200===t.code?Xi.info(`é…·æ¨å‘é€${a(o)}é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰`):400===t.code?Xi.info(`QQé…·æ¨(Cool Push)å‘é€${a(o)}æ¨é€å¤±è´¥ï¼š${t.msg}`):503===t.code?Xi.info(`QQé…·æ¨å‡ºé”™ï¼Œ${t.message}ï¼š${t.data}`):Xi.info(`é…·æ¨æ¨é€å¼‚å¸¸: ${JSON.stringify(t)}`)})).catch((t=>{Xi.info(`å‘é€${a(o)}é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼`),Xi.info(t)})).finally((()=>{n("")}))}else n("")}))}function ns(t,e,n={}){return new Promise((r=>{const{BARK_PUSH:o,BARK_SOUND:i,BARK_GROUP:a}=Qa;if(o){const s={url:`${o}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${i}&group=${a}&${Hi(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};Ya.get(s).then((t=>{200===t.code?Xi.info("Bark APPå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰"):Xi.info(`Bark APPå‘é€é€šå¤±è´¥ï¼š${t.message}`)})).catch((t=>{Xi.info("Bark APPå‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼"),Xi.error(t)})).finally((()=>{r("")}))}r("")}))}function rs(t,e){return new Promise((async n=>{const{TG_BOT_TOKEN:r,TG_USER_ID:o,TG_API_HOST:i,TG_PROXY_HOST:a,TG_PROXY_PORT:c,TG_PROXY_AUTH:u}=Qa;if(r&&o){const f={url:`https://${i}/bot${r}/sendMessage`,data:`chat_id=${o}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(a&&c){const t=(await Promise.resolve().then((function(){return s(require("tunnel"))}))).httpsOverHttp({proxy:{host:a,port:+c,proxyAuth:u},maxSockets:1});Object.assign(f,{httpsAgent:t})}Ya.post(f).then((t=>{t.ok?Xi.info("Telegramå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚"):400===t.error_code?Xi.info("è¯·ä¸»åŠ¨ç»™botå‘é€ä¸€æ¡æ¶ˆæ¯å¹¶æ£€æŸ¥æ¥æ”¶ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®ã€‚"):401===t.error_code&&Xi.info("Telegram bot token å¡«å†™é”™è¯¯ã€‚")})).catch((t=>{Xi.info("telegramå‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼"),Xi.info(t)})).finally((()=>{n("")}))}else n("")}))}function os(t,e){return new Promise((n=>{const{DD_BOT_TOKEN:r,DD_BOT_SECRET:o}=Qa,i={url:`https://oapi.dingtalk.com/robot/send?access_token=${r}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(r){if(o){const t=require("crypto"),e=Date.now(),n=t.createHmac("sha256",o);n.update(`${e}\n${o}`);const r=encodeURIComponent(n.digest("base64"));i.url=`${i.url}&timestamp=${e}&sign=${r}`}Ya.post(i).then((t=>{0===t.errcode?Xi.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚"):Xi.info(`é’‰é’‰å‘é€é€šçŸ¥å¤±è´¥ï¼š${t.errmsg}`)})).catch((t=>{Xi.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼"),Xi.info(t)})),n("")}else n("")}))}function is(t,e){return new Promise((n=>{const{QYWX_KEY:r}=Qa,o={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${r}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};r&&Ya.post(o).then((t=>{0===t.errcode?Xi.info("ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚"):Xi.info(`ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥å¤±è´¥ï¼š${t.errmsg}`)})).catch((t=>{Xi.info("ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼"),Xi.info(t)})).finally((()=>{n("")})),n("")}))}function as(t){const{QYWX_AM:e}=Qa,n=null==e?void 0:e.split(",");if(n[2]){const e=n[2].split("|");let r="";for(let n=0;n<e.length;n++){const o="ç­¾åˆ°å· "+(n+1);t.match(o)&&(r=e[n])}return r||(r=n[2]),r}return"@all"}function ss(t,e){return new Promise((n=>{const r=Qa.QYWX_AM;if(r){const o=r.split(","),i={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${o[0]}`,corpsecret:`${o[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};Ya.post(i).then((r=>{const i=e.replace(/\n/g,"<br/>"),a=JSON.parse(r).access_token;let s;switch(o[4]){case"0":s={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"æ›´å¤š"}};break;case"1":s={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${o[4]}`,author:"æ™ºèƒ½åŠ©æ‰‹",content_source_url:"",content:`${i}`,digest:`${e}`}]}}}o[4]||(s={msgtype:"text",text:{content:`${t}\n\n${e}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${as(e)}`,agentid:`${o[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},Ya.post(s).then((t=>{0===t.errcode?Xi.info("æˆå‘˜ID:"+as(e)+"ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚"):Xi.info(`ä¼ä¸šå¾®ä¿¡åº”ç”¨ï¼š${t.errmsg}`)})).catch((t=>{Xi.info("æˆå‘˜ID:"+as(e)+"ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼"),Xi.info(t)})).finally((()=>{n("")}))})).catch((t=>{Xi.error("ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼")}))}else n("")}))}function cs(t,e,n={}){return new Promise((r=>{const{IGOT_PUSH_KEY:o}=Qa;if(o){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(o))return Xi.info("æ‚¨æ‰€æä¾›çš„IGOT_PUSH_KEYæ— æ•ˆ"),void r("");const i={url:`https://push.hellyw.com/${o.toLowerCase()}`,data:`title=${t}&content=${e}&${Hi(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};Ya.post(i).then((t=>{"string"==typeof t&&(t=JSON.parse(t)),0===t.ret?Xi.info("iGotå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰"):Xi.info(`iGotå‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼š${t.errMsg}`)})).catch((t=>{Xi.info("iGotå‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼"),Xi.info(t)})).finally((()=>{r("")}))}else r("")}))}function us(t,e){return new Promise((n=>{const{PUSH_PLUS_TOKEN:r,PUSH_PLUS_USER:o}=Qa;if(r){e=e.replace(/[\n\r]/g,"<br>");const i={url:"https://www.pushplus.plus/send",data:{token:`${r}`,title:`${t}`,content:`${e}`,topic:`${o}`},headers:{"Content-Type":" application/json"},timeout:15e3};Ya.post(i).then((t=>{200===t.code?Xi.info(`push+å‘é€${o?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å®Œæˆã€‚`):Xi.info(`push+å‘é€${o?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼š${t.msg}`)})).catch((t=>{Xi.info(`push+å‘é€${o?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼`),Xi.info(t)})).finally((()=>{n("")}))}else n("")}))}var fs=Object.freeze({__proto__:null,sendMessage:async function(t,e){Xi.info("----ã€æ¶ˆæ¯æ¨é€ã€‘----"),t=`Bili-${Ta.nickname||$a.USERID}-${t}`,await async function(t,e,n={},r="\n\næœ¬é€šçŸ¥ Byï¼šhttps://github.com/KudouRan/BiliTools"){Va(),e+=r,await Promise.all([ts(t,e),us(t,e)]),await Promise.all([ns(t,e,n),rs(t,e),os(t,e),is(t,e),ss(t,e),cs(t,e,n),Xa(t,e),Za(t,e),es(t,e)])}(t,e,void 0,"")}});const ls=Ja({baseURL:Na,headers:{"user-agent":$a.USER_AGENT}}),ds=Ja({baseURL:Ba,headers:{Referer:ja,"user-agent":$a.USER_AGENT}}),ps=Ja({baseURL:Da,headers:{Referer:ja,"user-agent":$a.USER_AGENT}}),gs=Ja({baseURL:Ma,headers:{"user-agent":$a.USER_AGENT}}),ms=Ja({baseURL:Fa,headers:{"user-agent":$a.USER_AGENT}}),hs=Ja({baseURL:Ga,headers:{"user-agent":$a.USER_AGENT}});function ys(t=1,e=50,n=1){return ds.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`)}function _s({ruid:t,gift_num:e,bag_id:n,gift_id:r,roomid:o}){const i=$a.BILIJCT,a=i,s={gift_id:r,ruid:t,gift_num:e,bag_id:n,biz_id:o,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:i,platform:"pc",biz_code:"Live",csrf_token:a,uid:$a.USERID};return ds.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:La}})}function ws(t){return ds.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${t}`)}function vs(){return ps.get("/x/web-interface/nav",{headers:{Origin:xa}})}function bs(){return ps.get("/x/web-interface/coin/today/exp")}function $s(t=1,e=50,n=-10){return ps.get("/x/relation/tag",{params:{tagid:n,pn:t,ps:e}})}function Ts(t,e){return ps.post("/x/relation/tags/addUsers?cross_domain=true",{fids:t,tagids:e,csrf:$a.BILIJCT},{headers:{Origin:Ua}})}function Ss(t){const e=t.level_info,n=e.current_level;if(n>=$a.BILI_TARGET_LEVEL&&(Ta.coinsTask=0),Xi.info(`å½“å‰ç­‰çº§: ${e.current_level}`),n>=6){const t=$a.function;t.shareAndWatch=!1,t.addCoins=!1,t.taskReward=!1,Xi.info("å·²ç»æ»¡çº§ï¼Œä¸éœ€è¦å†æŠ•å¸äº†ï¼Œåšä¸ªç™½å«–æ€ªå§")}else{const t=e.next_exp-e.current_exp;Xi.info(`è·ç¦»å‡çº§è¿˜éœ€è¦ ${t} ç»éªŒï¼Œé¢„è®¡ ${function(t){if($a.BILI_TARGET_COINS<=0)return t/15;const e=10*$a.BILI_TARGET_COINS+15,n=t/e,r=Ta.money/($a.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(t-r*e)/25+r}(t).toFixed(2)} å¤©`)}}async function Is(t){try{var e;const{data:n}=await ls.get("/site/getCoin");Xi.info(`ç™»å½•æˆåŠŸ: ${t.uname}`),Xi.info(`ç¡¬å¸ä½™é¢: ${n.money||0}`),Ta.nickname=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),Ta.money=n.money||0,Ta.userLevel=t.level_info.current_level,Ta.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,Ss(t),function(t){let e="";switch(Ta.vipType=t.vipType,Ta.vipStatus=t.vipStatus,t.vipType){case 0:e="æ— å¤§ä¼šå‘˜";break;case 1:e="æœˆåº¦å¤§ä¼šå‘˜";break;case 2:e="å¹´åº¦å¤§ä¼šå‘˜"}0===t.vipStatus&&(e="æ— å¤§ä¼šå‘˜"===e?e:e+"[å·²è¿‡æœŸ]"),Xi.info(`å¤§ä¼šå‘˜çŠ¶æ€: ${e}`)}(t)}catch(t){Xi.error(`è·å–ç¡¬å¸ä¿¡æ¯å¼‚å¸¸: ${t.message}`),Xi.debug(t)}}function Os(t,e,n=1){return ps.post("/x/web-interface/coin/add",{aid:t,multiply:e,selectLike:n,csrf:$a.BILIJCT})}function Cs(t,e=1){return Wa.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:t,multiply:e,csrf:$a.BILIJCT})}const Es="video",ks="audio",Ps="article";async function xs(t=!0){try{const e=$a.USERID,{data:n,message:r,code:o}=await(t?function(t=1,e=50){return $s(t,e,-10)}():function(t,e=1,n=50,r="desc",o="attention"){return ps.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:r,order_type:o}})}(e)),i=t?n:n.list;if(!i||0===i.length)return{msg:"-1",data:{}};if(0===o){await Oa();const{mid:t}=zi(i)||{};return await As(t)}return{msg:t?`æœªè·å–åˆ°ç‰¹åˆ«å…³æ³¨åˆ—è¡¨: ${o}-${r}`:`æœªè·å–åˆ°å…³æ³¨åˆ—è¡¨: ${o}-${r}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Ls(){const t=zi([1,3,4,5,160,22,119]);try{const{data:e,message:n,code:r}=await function(t=1,e=3){return ps.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}})}(t,3);if(0==r){const{aid:t,title:n,author:r}=zi(e);return{msg:"0",data:{id:Number(t),title:n,author:r}}}return{msg:`æœªè·å–åˆ°æ’è¡Œä¿¡æ¯: ${r}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Us(){const t=$a.BILI_CUSTOMIZE_UP;return 0===t.length?{msg:"-1",data:{}}:await As(zi(t))}async function As(t){try{const{code:e,data:n,message:r}=await function(t){return ps.get(`/x/space/navnum?mid=${t}`)}(t);if(e)return{msg:`é€šè¿‡uidè·å–è§†é¢‘å¤±è´¥: ${e}-${r}`,data:{}};await Oa();const{video:o,audio:i,article:a}=n,{type:s,page:c,index:u}=function([t,e,n]){const r=t+e+n;if(!r)return;const o=ji(0,r-1);let i=o;if(o<t)return{type:Es,page:Ri(30,i+1),index:i%30};const a=t+e;return i=o-t,o<a?{type:ks,page:Ri(30,i+1),index:i%30}:(i=o-a,{type:Ps,page:Ri(12,i+1),index:i%12})}([o,i,a]),f={[Es]:Rs,[ks]:js,[Ps]:Ns},l=await f[s](t,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(t){return Xi.debug(t),{msg:t.message,data:{}}}}async function Rs(t,e,n){const{code:r,data:o,message:i}=await function(t,e=30,n=1,r=""){return ps.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:e,mid:t}})}(t,30,e);if(r)return{message:i};const{aid:a,title:s,author:c}=o.list.vlist[n];return{type:Es,id:a,title:s,author:c}}async function js(t,e,n){const{code:r,data:o,msg:i}=await function(t,e=30,n=1){return ps.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}})}(t,30,e);if(r)return{message:i};const{data:a}=o,{id:s,uname:c,title:u}=a[n];return{type:ks,id:s,title:u,author:c}}async function Ns(t,e,n){const{code:r,data:o,message:i}=await function(t,e=12,n=1){return ps.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t},requestOptions:{isJsonp:!0}})}(t,12,e);if(r)return{message:i};const{articles:a}=o,{id:s,title:c,author:{name:u}}=a[n];return{type:Ps,id:s,title:c,author:u,mid:t}}const Bs=function(){const t=[Us,xs,()=>xs(!1),Ls];return $a.BILI_CUSTOMIZE_UP||t.shift(),t}();async function Ds(t=0){Bs.splice(0,Ta.currentStartFun+t);for(let t=0;t<Bs.length;t++){var e;const n=Bs[t];let r=Number(null!==(e=$a.BILI_COIN_RETRY_NUM)&&void 0!==e?e:4);for(r=r<1?1:r>8?8:r;r--;){await Oa();const t=await n();if("-1"===t.msg&&(r=0),"0"===t.msg)return t}r<=0&&(Ta.currentStartFun=t)}return{msg:"-1",data:{id:0}}}async function Ms({id:t,coin:e=1,type:n="video",mid:r}){const o={[Es]:Os,[ks]:Cs,[Ps]:(t,e=1)=>function(t,e,n=1){return ps.post("/x/web-interface/coin/add",{aid:e,upid:t,avtype:2,multiply:n,csrf:$a.BILIJCT})}(r,t,e)},i=await o[n](Number(t),e);return{code:i.code,message:i.message||i.msg}}async function Fs(t){if(await async function(){try{const{data:t,code:e}=await bs();if(0==e){const e=$a.BILI_TARGET_COINS-t/10;Ta.coinsTask=e>0?e:0}}catch(t){}}(),Ta.coinsTask<=0||Ta.money<=0)return!0;const{data:e,msg:n}=await Ds(t.priority);return null!=e&&e.id&&"0"==n?(await Oa(),await async function(t,e){const{id:n,title:r,author:o,type:i,mid:a}=t;try{const t=await Ms({id:n,type:i,mid:a});if(0===t.code)Ta.money--,Ta.coinsTask--,e.num++,Xi.info(`ç»™[${r}--upã€${o}ã€‘]æŠ•å¸æˆåŠŸ`);else if(34005===t.code)e.fillCount++,Xi.verbose(`å½“å‰ç¨¿ä»¶[${n}]ä¸èƒ½å†æŠ•å¸äº†`),e.fillCount>=3&&(Xi.warn("è‡ªå®šä¹‰ç”¨æˆ·ç»„æŠ•å¸ä¼¼ä¹æ²¡æœ‰å¸å¯æŠ•äº†"),e.priority++);else{if(-111===t.code||-104===t.code)return Xi.warn(`${n} ${t.message} æ— æ³•ç»§ç»­è¿›è¡ŒæŠ•å¸`),!0;if(e.eCount++,Xi.warn(`ç»™${n}æŠ•å¸å¤±è´¥ ${t.code} ${t.message}`),e.prevCode===t.code)return!0;e.prevCode=t.code}}catch(t){e.eCount++,Xi.error(`æŠ•å¸å¼‚å¸¸ ${t.message}`)}finally{await Oa(1500)}return!1}(e,t)):(t.eCount++,!1)}let Gs;async function qs(){Gs=0;try{const{code:t,msg:e,data:n}=await function(t=1,e=50){return gs.post("twirp/user.v1.User/GetCoupons?platform=web",{not_expired:!0,page_num:t,page_size:e,tab_type:1})}();if(0!==t)return void Xi.error(`è·å–æ¼«è¯»åˆ¸å¤±è´¥ï¼š${t} ${e}`);const{user_coupons:r}=n;if(0===r.length)return void Xi.info("æ²¡æœ‰æ¼«è¯»åˆ¸ï¼Œè·³è¿‡ä»»åŠ¡");const o=r.filter((t=>0!==t.will_expire));return Gs=o.reduce(((t,e)=>t+e.remain_amount),0),Gs}catch(t){Xi.error(`è·å–æ¼«è¯»åˆ¸å¼‚å¸¸: ${t}`)}}async function Hs(){try{const{code:t,msg:e,data:n}=await function(t=1,e=50,n=1){return gs.post("twirp/bookshelf.v1.Bookshelf/ListFavorite?platform=web",{page_num:t,page_size:e,order:n,wait_free:0})}();if(0===t)return n;Xi.error(`è·å–è¿½æ¼«åˆ—è¡¨å¤±è´¥ï¼š${t} ${e}`)}catch(t){Xi.error(`è·å–è¿½æ¼«åˆ—è¡¨å¼‚å¸¸: ${t}`)}}async function zs(t){try{const{code:e,msg:n,data:r}=await function(t){return gs.post("twirp/comic.v1.Comic/ComicDetail",{device:"android",version:"4.16.0",comic_id:t})}(t);if(0!==e)return void Xi.error(`è·å–æ¼«ç”»è¯¦æƒ…å¤±è´¥ï¼š${e} ${n}`);if(!r||!r.ep_list)return;let o=r.ep_list;return 0!==r.disable_coupon_amount&&(o=o.slice(0,o.length-r.disable_coupon_amount)),o.filter((t=>t.is_locked))}catch(t){Xi.error(`è·å–æ¼«ç”»è¯¦æƒ…å¼‚å¸¸: ${t}`)}}async function Ks(t){try{const{code:e,msg:n,data:r}=await function(t){return gs.post("twirp/comic.v1.Comic/GetEpisodeBuyInfo?platform=web",{ep_id:t})}(t);if(0!==e)return void Xi.error(`è·å–è´­ä¹°ä¿¡æ¯å¤±è´¥ï¼š${e} ${n}`);if(!r)return;if(!r.allow_coupon)return void Xi.info("æ¼«ç”»ä¸æ”¯æŒæ¼«è¯»åˆ¸");if(0===r.recommend_coupon_id||0===r.remain_coupon)return Gs=0,void Xi.info("æ²¡æœ‰è¶³å¤Ÿçš„æ¼«è¯»åˆ¸äº†");if(!r.remain_lock_ep_num)return;return r.recommend_coupon_id}catch(t){Xi.error(`è·å–è´­ä¹°ä¿¡æ¯å¼‚å¸¸: ${t}`)}}async function Js(t){try{const e=await Ks(t);if(!e)return!0;const{code:n,msg:r}=await function(t,e,n=2,r=0){return gs.post("twirp/comic.v1.Comic/BuyEpisode?&platform=web",{buy_method:n,ep_id:t,coupon_id:e,auto_pay_gold_status:r})}(t,e);if(0!==n)return void Xi.error(`è´­ä¹°æ¼«ç”»å¤±è´¥ï¼š${n} ${r}`);Gs--,Xi.info("è´­ä¹°æ¼«ç”»æˆåŠŸ")}catch(t){Xi.error(`è´­ä¹°æ¼«ç”»å¼‚å¸¸: ${t}`)}}async function Ys(t){try{const{code:e,msg:n,data:r}=await function(t,e=1,n=9){return gs.post("twirp/comic.v1.Comic/Search?device=pc&platform=web",{keyword:t,page_num:e,page_size:n})}(t);if(0===e)return r;Xi.error(`æœç´¢æ¼«ç”»å¤±è´¥ï¼š${e} ${n}`)}catch(t){Xi.error(`æœç´¢æ¼«ç”»å¼‚å¸¸: ${t}`)}}async function Ws(t){const e=await zs(t);if(!e||0===e.length)return!1;for(let t=0;t<e.length;t++)if(await Oa(100),await Js(e[t].id))return!0}async function Qs(){Gs=await qs(),Gs<1?Xi.info("æ²¡æœ‰å³å°†è¿‡æœŸçš„æ¼«è¯»åˆ¸ï¼Œè·³è¿‡ä»»åŠ¡"):(await async function(){const{mc:t}=$a.manga;if(0!==t.length)for(let e=0;e<t.length;e++){if(Gs<=0)return;const n=t[e];await Ws(n)}}(),await async function(){const{name:t}=$a.manga;if(0!==t.length)for(let e=0;e<t.length;e++){if(Gs<=0)return;const n=t[e],r=await Ys(n);if(!r||0===r.list.length)continue;const o=r.list.find((t=>t.title===n));o&&await Ws(o.id)}}(),await async function(){const{love:t}=$a.manga;if(!t||Gs<=0)return;const e=await Hs();if(e&&0!==e.length)for(let t=0;t<e.length;t++){if(Gs<=0)return;const n=e[t];await Ws(n.comic_id)}}())}async function Vs(){try{const{code:t}=await function(t="android"){return gs.post("twirp/activity.v1.Activity/ClockIn",{platform:t})}();0==t?Xi.info("æ¼«ç”»ç­¾åˆ°æˆåŠŸ"):Xi.warn("æ¼«ç”»ç­¾åˆ°å¤±è´¥")}catch(t){const{status:e,statusCode:n}=t.response||{};400===e||400===n?Xi.info("å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œè·³è¿‡ä»»åŠ¡"):Xi.error(`æ¼«ç”»ç­¾åˆ°å¼‚å¸¸ ${t.message}`)}}async function Xs(){try{const{data:t,code:e,message:n}=await ms.get("/link_group/v1/member/my_groups");return 0===e?(null==t?void 0:t.list)||[]:(Xi.warn(`è·å–è‡ªå·±çš„åº”æ´å›¢å¼‚å¸¸å¤±è´¥: ${n}`),[])}catch(t){Xi.error(`è·å–è‡ªå·±çš„åº”æ´å›¢å¼‚å¸¸: ${t}`)}}var Zs={},tc=St,ec=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=tc(e),this.reject=tc(n)};Zs.f=function(t){return new ec(t)};var nc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},rc=St,oc=w,ic=R(R.bind),ac={},sc=ac,cc=ie("iterator"),uc=Array.prototype,fc=$o,lc=Ot,dc=ac,pc=ie("iterator"),gc=function(t){if(null!=t)return lc(t,pc)||lc(t,"@@iterator")||dc[fc(t)]},mc=$,hc=St,yc=je,_c=vt,wc=gc,vc=TypeError,bc=$,$c=je,Tc=Ot,Sc=function(t,e){return rc(t),void 0===e?t:oc?ic(t,e):function(){return t.apply(e,arguments)}},Ic=$,Oc=je,Cc=vt,Ec=function(t){return void 0!==t&&(sc.Array===t||uc[cc]===t)},kc=cr,Pc=rt,xc=function(t,e){var n=arguments.length<2?wc(t):e;if(hc(n))return yc(mc(n,t));throw vc(_c(t)+" is not iterable")},Lc=gc,Uc=function(t,e,n){var r,o;$c(t);try{if(!(r=Tc(t,"return"))){if("throw"===e)throw n;return n}r=bc(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;return $c(r),n},Ac=TypeError,Rc=function(t,e){this.stopped=t,this.result=e},jc=Rc.prototype,Nc=function(t,e,n){var r,o,i,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=Sc(e,f),m=function(t){return r&&Uc(r,"normal",t),new Rc(!0,t)},h=function(t){return l?(Oc(t),p?g(t[0],t[1],m):g(t[0],t[1])):p?g(t,m):g(t)};if(d)r=t;else{if(!(o=Lc(t)))throw Ac(Cc(t)+" is not iterable");if(Ec(o)){for(i=0,a=kc(t);a>i;i++)if((s=h(t[i]))&&Pc(jc,s))return s;return new Rc(!1)}r=xc(t,o)}for(c=r.next;!(u=Ic(c,r)).done;){try{s=h(u.value)}catch(t){Uc(r,"throw",t)}if("object"==typeof s&&s&&Pc(jc,s))return s}return new Rc(!1)},Bc=$,Dc=St,Mc=Zs,Fc=nc,Gc=Nc;function qc(t){return Object.keys(t).forEach((e=>{Ii(t[e])?t[e]=t[e].toString():Ti(t[e])?qc(t[e]):Ei(t[e])&&(t[e]=t[e].map((t=>Ti(t)?qc(t):t.toString())))})),t}function Hc(t){let e=JSON.stringify(qc(t));const n=["SHA512","SHA3-512","SHA384","SHA3-384","BLAKE2b512"];for(const t of n)e=c.createHash(t).update(e).digest("hex");return e}Vr({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=Mc.f(e),r=n.resolve,o=n.reject,i=Fc((function(){var n=Dc(e.resolve),o=[],i=0,a=1;Gc(t,(function(t){var s=i++,c=!1;a++,Bc(n,e,t).then((function(t){c||(c=!0,o[s]={status:"fulfilled",value:t},--a||r(o))}),(function(t){c||(c=!0,o[s]={status:"rejected",reason:t},--a||r(o))}))})),--a||r(o)}));return i.error&&o(i.value),n.promise}});const zc=["(âŒ’â–½âŒ’)","ï¼ˆï¿£â–½ï¿£ï¼‰","(=ãƒ»Ï‰ãƒ»=)","(ï½€ãƒ»Ï‰ãƒ»Â´)","(ã€œï¿£â–³ï¿£)ã€œ","(ï½¥âˆ€ï½¥)","(Â°âˆ€Â°)ï¾‰","(ï¿£3ï¿£)","â•®(ï¿£â–½ï¿£)â•­","_(:3ã€âˆ )_","( Â´_ã‚ï½€)","â†_â†","â†’_â†’","(<_<)","(>_>)","(;Â¬_Â¬)","(ï¾ŸĞ”ï¾Ÿâ‰¡ï¾ŸĞ´ï¾Ÿ)!?","Î£(ï¾ŸĞ´ï¾Ÿ;)","Î£( ï¿£â–¡ï¿£||)","(Â´ï¼›Ï‰ï¼›`)","ï¼ˆ/TĞ”T)/","(^ãƒ»Ï‰ãƒ»^ )","(ï½¡ï½¥Ï‰ï½¥ï½¡)","(â—ï¿£(ï½´)ï¿£â—)","Îµ=Îµ=(ãƒâ‰§âˆ‡â‰¦)ãƒ","(Â´ï½¥_ï½¥`)","(-_-#)","ï¼ˆï¿£ã¸ï¿£ï¼‰","(ï¿£Îµ(#ï¿£) Î£","ãƒ½(`Ğ”Â´)ï¾‰","ï¼ˆ#-_-)â”¯â”â”¯","(â•¯Â°å£Â°)â•¯(â”´â€”â”´","â†â—¡â†","( â™¥Ğ´â™¥)","Î£>â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’","â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„","(â•¬ï¾ŸĞ´ï¾Ÿ)â–„ï¸»â”»â”³â•ä¸€","ï½¥*ï½¥:â‰¡(ã€€Îµ:)","(æ±—)","(è‹¦ç¬‘)"].concat("1","2","3","4","5","6","7","8","9","ç­¾åˆ°","å“ˆå“ˆ"),Kc=new Vi({console:"debug",file:"debug",push:"warn"},"live");async function Jc(){let t=99,e=0;const n=[];try{for(;e<t;){const{code:r,message:o,data:i}=await ys(e+1,50,$a.USERID);if(0!==r)return Xi.verbose(`è·å–å‹‹ç« ä¿¡æ¯å¤±è´¥ ${r} ${o}`),null;if(!i)return n;t=i.page_info.total_page,e=i.page_info.current_page,n.push(...i.list,...i.special_list)}return n}catch(t){return Xi.error(`è·å–å‹‹ç« å¼‚å¸¸ ${t.message}`),null}}function Yc({room_info:t,medal:e}){if(null==t||!t.room_id)return!1;if(e.level>=20)return!1;if(e.today_feed>=e.day_limit)return!1;if(e.today_feed>=1300)return!1;const{whiteList:n,blackList:r}=$a.intimacy;return n&&n.length?!(!n.includes(t.room_id)&&!n.includes(e.target_id)):!r||!r.includes(t.room_id)&&!r.includes(e.target_id)}async function Wc(t,e){const n=zc[ji(zc.length-1)];try{const{code:r,message:o}=await function(t,e){const n=$a.BILIJCT,r=n;return e||(e=ji(10).toString()),ds.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:r})}(t,n);return 0===r||(11e3===r?(Xi.warn(`ã€${e}ã€‘${t}-å¯èƒ½æœªå¼€å¯è¯„è®º`),!1):(Xi.warn(`ã€${e}ã€‘${t}-å‘é€å¤±è´¥ ${o}`),Xi.verbose(`code: ${r}`),!1))}catch(t){Xi.verbose(`å‘é€å¼¹å¹•å¼‚å¸¸ ${t.message}`)}}async function Qc(t){try{const{code:n,message:r,data:o}=await(e=t,ds.post("xlive/web-room/v1/index/TrigerInteract",{roomid:e,interact_type:3,csrf:$a.BILIJCT,csrf_token:$a.BILIJCT,visit_id:""}));if(0===n)return o;Xi.info(`ã€${t}ã€‘ç›´æ’­é—´åˆ†äº«å¤±è´¥ ${n} ${r}`)}catch(e){Xi.warn(`åˆ†äº«ç›´æ’­é—´ [${t}] å¼‚å¸¸ ${e.message}`)}var e}async function Vc(t){try{const{code:n,message:r,data:o}=await(e=t,ds.post("xlive/web-ucenter/v1/interact/likeInteract",{roomid:e,csrf:$a.BILIJCT,csrf_token:$a.BILIJCT}));if(0===n)return o;Xi.info(`ã€${t}ã€‘ç›´æ’­é—´ç‚¹èµå¤±è´¥ ${n} ${r}`)}catch(t){Xi.warn(`ç‚¹èµç›´æ’­é—´å¼‚å¸¸ ${t.message}`)}var e}async function Xc(t,e){if(!(e.value>=31))try{const{code:n,message:r}=await function({buvid:t=Bi(37).toUpperCase(),gu_id:e=Bi(43).toLocaleUpperCase(),visit_id:n=Bi(32).toLocaleLowerCase(),uuid:r=Li(),click_id:o=Li(),room_id:i,up_id:a,uid:s,up_level:c=40,up_session:u="",parent_id:f=11,area_id:l=376}){const d={platform:"android",uuid:r,buvid:t,seq_id:"1",room_id:i,parent_id:f,area_id:l,timestamp:String(parseInt(String((new Date).getTime()/1e3))-60),secret_key:"axoaadsffcazxksectbbb",watch_time:"60",up_id:a||s,up_level:c,jump_from:"30000",gu_id:e,play_type:"0",play_url:"",s_time:"0",data_behavior_id:"",data_source_id:"",up_session:u,visit_id:n,watch_status:"",click_id:o,session_id:"-99998",player_type:"0",client_ts:String(parseInt(String((new Date).getTime()/1e3)))},p={...d,ts:parseInt(String((new Date).getTime()/1e3)),client_sign:Hc(d),csrf_token:$a.BILIJCT,csrf:$a.BILIJCT};return hs.post("xlive/data-interface/v1/heartbeat/mobileHeartBeat",p,{headers:{"User-Agent":Ha()}})}(t);if(0!==n)return void Xi.warn(`ç›´æ’­é—´å¿ƒè·³å¤±è´¥ ${n} ${r}`);e.value++,Kc.info(`ç›´æ’­é—´å¿ƒè·³æˆåŠŸ ${t.uname}ï¼ˆ${e.value}/31ï¼‰`)}catch(t){Kc.error(t),Xi.error(`ç›´æ’­é—´å¿ƒè·³å¼‚å¸¸ ${t.message}`)}}async function Zc(){const t=(e=await Jc())&&0!==e.length?e.filter(Yc):[];var e;return await Promise.allSettled([tu(t),eu(t)])}async function tu(t){for(let e=0;e<t.length;e++){const n=t[e];await nu(n)}}async function eu(t){if(0===t.length)return;const{liveHeart:e}=$a.intimacy;return e?new Promise((e=>function(t,e){for(let t=0;t<e.length;t++){const r={value:0},o=e[t],i={value:void 0},a={buvid:Bi(37).toUpperCase(),gu_id:Bi(43).toLocaleUpperCase(),visit_id:Bi(32).toLocaleLowerCase(),uuid:Li(),click_id:Li()};n(o,a,r,i),i.value=setInterval(n,6e4,o,a,r,i),Ca(50,150)}async function n({medal:t,anchor_info:e,room_info:n},r,o,i){await Xc({up_id:t.target_id,room_id:n.room_id,uname:e.nick_name,...r},o),o.value>=31&&i&&i.value&&clearInterval(i.value)}t("ç›´æ’­é—´å¿ƒè·³")}(e,t))):void 0}async function nu(t){const{room_info:e,anchor_info:n}=t;if(!e||!n)return;const{liveLike:r,liveSendMessage:o,liveShare:i}=$a.intimacy,a=n.nick_name,s=e.room_id;o&&(Kc.verbose(`ã€${a}ã€‘å¼€å§‹å‘é€ç›´æ’­å¼¹å¹•`),await Wc(s,a)),i&&async function(){await Oa(100,300);for(let t=0;t<5;t++)Kc.verbose(`åˆ†äº« [${a}] ç›´æ’­é—´`),await Qc(s),await Oa(4e3)}().catch((t=>Xi.error(t))),r&&async function(){await Oa(100,300);for(let t=0;t<3;t++)Kc.verbose(`ç»™ [${a}] ç›´æ’­é—´ç‚¹èµ`),await Vc(s),await Oa(6500)}().catch((t=>Xi.error(t))),await Oa(22e3)}async function ru(){try{const{data:t,message:e,code:n}=await vs();if(0!==n)return void Xi.warn(`è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼š${n} ${e}`);!function(t){var e;Ta.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){Xi.error(`è·å–ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸ï¼š${t.message}`)}}var ou;async function iu(){try{const{data:t,code:e,message:n}=await ps.get("/x/vip/privilege/my",{headers:{origin:xa,referer:ja}});if(0!==e)return void Xi.info(`è·å–é¢†å–çŠ¶æ€å¤±è´¥ï¼š${e} ${n}`);const{list:r}=t,o=r.filter((t=>0===t.state));return 0===o.length?void Xi.info("æš‚æ— å¯é¢†å–æƒç›Šï¼ˆå·²é¢†å–ï¼‰"):o}catch(t){Xi.error(`è·å–é¢†å–çŠ¶æ€å‡ºç°å¼‚å¸¸ï¼š${t.message}`)}}async function au(t){try{const e=function(t){switch(t){case 1:return"B å¸åˆ¸";case 2:return"ä¼šå‘˜è´­ä¼˜æƒ åˆ¸";case 3:return"æ¼«è¯»åˆ¸";case 4:return"ä¼šå‘˜è´­è¿è´¹åˆ¸";default:return"æœªçŸ¥"}}(t),{code:n,message:r}=await function(t=1){return ps.post("/x/vip/privilege/receive",{csrf:$a.BILIJCT,type:t},{headers:{origin:Ra,referer:ja}})}(t);let o="æˆåŠŸ";return 0!==n&&(o=`å¤±è´¥ ${r}`),Xi.info(`é¢†å–${e}${o}`),!0}catch(t){Xi.error(`é¢†å–æƒç›Šå‡ºç°å¼‚å¸¸ï¼š${t.message}`),Xi.error(t)}return!1}async function su(t){let e=0,n=!1;for(;!(n||(n=await au(t),e>2));)e++;return n}!function(t){t[t["æˆåŠŸ"]=4]="æˆåŠŸ",t[t["ä½äº20ç”µæ± "]=-2]="ä½äº20ç”µæ± ",t[t["Bå¸ä¸è¶³"]=-4]="Bå¸ä¸è¶³"}(ou||(ou={}));let cu=0;async function uu(){try{const{data:{list:t}}=await function(t=3394945){const e=(new Date).getTime();return ds.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`)}();return t.filter((t=>{if(t.expire_at<=0)return!1;const e=(1e3*t.expire_at-(new Date).getTime())/864e5<2,n=![1,30607,30426,31531].includes(t.gift_id);return n&&e&&Xi.info(`${t.gift_name} å³å°†è¿‡æœŸè¯·å°½å¿«æŠ•å–‚`),!n&&e}))}catch(t){if(cu)return null;await uu(),cu++}}async function fu(t){try{const{data:{live_room:e,name:n}}=await function(t){return ps.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`)}(t);if(await Oa(),e.roomStatus)return{roomid:e.roomid,name:n}}catch{}}function lu(t,e,n,r){const o=$a.BILIJCT,i={is_fav:0,main_id:e,oid:t,detail_id:n,count:r,csrf:o,csrf_token:o};return ps.post("/x/esports/guess/add",i)}function du(){return Ta.money-$a.MATCH_COINS<$a.BILI_TARGET_COINS&&(Xi.info(`éœ€è¦ä¿ç•™${$a.BILI_TARGET_COINS}ä¸ªç¡¬å¸ï¼Œä»»åŠ¡ç»“æŸ`),!0)}async function pu(){const{data:t,code:e}=await $s(1,1,0);if(0!==e)throw new Error(`è·å–æœ€åä¸€ä¸ªå…³æ³¨å¤±è´¥: ${e}`);return t[0]}async function gu(t){const{data:e,code:n}=await ps.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return e.find((e=>e.name===t));Xi.warn(`è·å–åˆ†ç»„åˆ—è¡¨å¤±è´¥: ${n}`)}async function mu(t){const e=await gu(t);if(e)return e.tagid;await Oa(300);const{data:n,code:r,message:o}=await(i=t,ps.post("/x/relation/tag/create",{tag:i,jsonp:"jsonp",csrf:$a.BILIJCT}));var i;if(22106===r){await Oa(300);const e=await gu(t);return e&&e.tagid}return 0!==r&&Xi.warn(`åˆ›å»ºåˆ†ç»„å¤±è´¥: ${r}-${o}`),n.tagid}async function hu(t,e="å¤©é€‰æ—¶åˆ»"){if(0===t.length)return;const n=await mu(e);if(n)for(const e of t){const{code:t,message:r}=await Ts(e.mid,n);0!==t&&Xi.warn(`ç§»åŠ¨ã€${e.uname}ã€‘å¤±è´¥: ${t}-${r}`),await Oa()}}async function yu(t,e,n,r=1){if(t.length>e.length)return;const{data:o,code:i,message:a}=await $s(r,20,0);if(0===i){for(const{mid:r,uname:i}of o){if(t.length>=e.length)return;if(r===n)return;(e.includes(r)||e.includes(i))&&t.push({mid:r,uname:i})}if(!(o.length<20))return await yu(t,e,n,r+1)}else Xi.warn(`è·å–å…³æ³¨ç”¨æˆ·å¤±è´¥: ${i}-${a}`)}const _u=0,wu=1,vu=5,bu=1,$u=504,Tu=1096;let Su;async function Iu(){try{const{data:t,code:e,message:n}=await ds.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==e&&Xi.info(`è·å–ç›´æ’­åˆ†åŒºå¤±è´¥: ${e}-${n}`),t.data.map((t=>t.list)).map((t=>t.map((t=>({areaId:t.id,parentId:t.parent_id})))))}catch(t){throw Xi.error(`è·å–ç›´æ’­åˆ†åŒºå¼‚å¸¸: ${t.message}`),t}}async function Ou(t,e,n=1,r="lottery"){try{await Oa(100);const{data:o,code:i,message:a}=await function(t,e,n=1){return ds.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${t}&area_id=${e}&page=${n}`)}(e,t,n);return 0!==i&&Xi.info(`è·å–ç›´æ’­é—´åˆ—è¡¨å¤±è´¥: ${i}-${a}`),function(t){const e=[],n=[];return t.forEach((t=>{const r=t.pendant_info[2];r&&(r.pendent_id===$u?e.push(t):r.pendent_id===Tu&&n.push(t))})),{lotteryTime:e,lotteryPacket:n}}(o.list)["lottery"===r?"lotteryTime":"lotteryPacket"]}catch(t){throw Xi.error(`è·å–ç›´æ’­é—´åˆ—è¡¨å¼‚å¸¸: ${t.message}`),t}}async function Cu(t,e,n=1){const r=await Ou(t,e,n),o=[];for(const t of r){const e=await Eu(t);e&&(o.push({...e,uid:t.uid,uname:t.uname}),await Oa(100))}return o}async function Eu(t){const{blackUid:e}=$a.lottery;if(e.includes(t.uid))return void Xi.info(`è·³è¿‡é»‘åå•ç”¨æˆ·: ${t.uname}`);let n,r,o;try{({data:r,code:n,message:o}=await ws(t.roomid))}catch(e){return void Xi.info(`ç›´æ’­é—´${t.roomid}æ£€æµ‹å¼‚å¸¸: ${e.message}`)}if(0!==n)return void Xi.debug(`ç›´æ’­é—´${t.roomid}æ£€æµ‹å¤±è´¥: ${n}-${o}`);if(null===r)return;const{excludeAward:i,includeAward:a}=$a.lottery,s=i.some((t=>r.award_name.match(t)));if(a.some((t=>r.award_name.match(t)))||!s){if(r.status===bu&&!(r.gift_price>0))return 4===r.require_type&&(Xi.info("æ‚¨èƒ½åé¦ˆç»™ä½œè€…è¾“å‡ºäº†ä»€ä¹ˆå—ï¼Ÿ"),Xi.info(`${r.require_type}--${r.require_text}--${r.require_value}`),Xi.info("ä¹Ÿè®¸è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚")),r.require_type===vu&&Ta.userLevel>=r.require_value||r.require_type===_u?r:r.require_type!==wu||$a.lottery.skipNeedFollow?void 0:r}else Xi.info(`è·³è¿‡å±è”½å¥–å“: ${r.award_name}`)}async function ku(t,e=!0){try{const{id:r,gift_id:o,gift_num:i,award_name:a,uid:s,uname:c,require_type:u,require_text:f}=t;Xi.info(`å¤©é€‰ä¸»æ’­ï¼šã€${c}ã€‘`),Xi.info(`å¥–å“ï¼š${a}`);const{code:l,message:d}=await(n={id:r,gift_id:o,gift_num:i},ds.post("/xlive/lottery-interface/v1/Anchor/Join",{...n,csrf:$a.BILIJCT,csrf_token:$a.BILIJCT,visit_id:Di(),platform:"pc"}));if(0!==l)return void Xi.info(`å¤©é€‰å¤±è´¥: ${l}-${d}`);if(Xi.info("å¤©é€‰æˆåŠŸ âˆš"),u===wu&&e){Mi(Su,s);(function(t){const e=(t=t.replace("å…³æ³¨ä¸»æ’­","")).split(/\s*\+\s*/);return e.shift(),e})(f).forEach((t=>Mi(Su,t)))}}catch(t){Xi.info(`å¤©é€‰å¼‚å¸¸: ${t.message}`)}var n}async function Pu(t,e,n=2){for(let r=1;r<=n;r++){const n=await Cu(t,e,r);for(const t of n)await ku(t),await Oa(300)}}async function xu(t){try{const{data:e,code:n}=await function(t){return ds.get(`/xlive/lottery-interface/v1/lottery/getLotteryInfoWeb?roomid=${t}`)}(t);if(0!==n)return;const{popularity_red_pocket:r}=e;if(!r)return;const{lot_id:o,lot_status:i}=r[0];if(2===i)return;return o}catch(t){}}async function Lu(t,e,n=1){const r=await Ou(t,e,n,"redPack"),o=[];for(const t of r){const e=await xu(t.roomid);e&&(o.push({uid:t.uid,uname:t.uname,lot_id:e,room_id:t.roomid}),await Oa(100))}return o}async function Uu(t){try{const{lot_id:n,uid:r,uname:o,room_id:i}=t;Xi.info(`çº¢åŒ…ä¸»æ’­ï¼šã€${o}ã€‘`);const{code:a,message:s}=await(e={room_id:i,lot_id:n,ruid:r},ds.post("/xlive/lottery-interface/v1/popularityRedPocket/RedPocketDraw",{...e,spm_id:"444.8.red_envelope.extract",jump_from:"",session_id:"",csrf_token:$a.BILIJCT,csrf:$a.BILIJCT,visit_id:""}));if(0!==a)return void Xi.info(`çº¢åŒ…å¤±è´¥: ${a}-${s}`);Su.push(r),Xi.info("çº¢åŒ…æˆåŠŸ âˆš")}catch(t){Xi.info(`çº¢åŒ…å¼‚å¸¸: ${t.message}`)}var e}async function Au(t,e,n=2){for(let r=1;r<=n;r++){const n=await Lu(t,e,r);for(const t of n)await Uu(t),await Oa(200)}}async function Ru(){const t=[];return await async function e(n=1){try{var r;const{data:o,code:i,message:a}=await function(t=1,e=9){return ds.get(`/xlive/web-ucenter/user/following?page=${t}&page_size=${e}`)}(n,9);if(0!==i)return void Xi.info(`è·å–å…³æ³¨ç›´æ’­é—´å¤±è´¥: ${i}-${a}`);const s=null===(r=o.list)||void 0===r?void 0:r.filter((t=>1===t.live_status));if(9===s.length&&n<o.totalPage)return t.push(...s),e(n+1);t.push(...s)}catch(t){Xi.error(`è·å–å…³æ³¨ç›´æ’­é—´å¼‚å¸¸: ${t.message}`)}}(),t}async function ju(t){try{const{code:e,message:n,data:r}=await ws(t.roomid);if(0!==e)return void Xi.debug(`ç›´æ’­é—´${t.roomid}æ£€æµ‹å¤±è´¥: ${e}-${n}`);if(null===r)return;if(r.status!==bu)return;if(r.gift_price>0)return;return r}catch(e){return void Xi.info(`ç›´æ’­é—´${t.roomid}æ£€æµ‹å¼‚å¸¸: ${e.message}`)}}async function Nu(){const{scanFollow:t}=$a.lottery;if(!t)return!0;try{Xi.info("å¼€å§‹æ‰«æå…³æ³¨çš„ä¸»æ’­");const t=await async function(){const t=await Ru(),e=[];for(const n of t){const t=await ju(n);t&&e.push({...t,uid:n.uid,uname:n.uname}),await Oa(100)}return e}();for(const e of t)await ku(e,!1),await Oa(300);Xi.info("å…³æ³¨çš„ä¸»æ’­å¤©é€‰å®Œæˆ")}catch(t){Xi.error(`å…³æ³¨çš„ä¸»æ’­å¤©é€‰å¼‚å¸¸: ${t.message}`)}return"only"!==t}async function Bu(t){try{const{code:e,message:n,data:r}=await function({session_type:t}={session_type:1}){return ms.get(`/session_svr/v1/session_svr/get_sessions?session_type=${t}&group_fold=1&unfollow_fold=1&sort_rule=2&build=0&mobi_app=web`)}();if(0!==e)return void Xi.warn(`è·å–ä¼šè¯å¤±è´¥ï¼š${e}-${n}`);const{session_list:o}=r;if(o.length<=0)return;return o.filter((({unread_count:e,talker_id:n,is_follow:r,last_msg:o})=>{return t.find((t=>t.mid===n))&&e>0&&n===o.sender_uid&&1===r&&(i=o.timestamp,Date.now()-1e3*i<36e5);var i}))}catch(t){Xi.error(`è·å–ä¼šè¯å¼‚å¸¸ï¼š${t.message}`)}}async function Du(t){const e=await Bu(t);await Oa(200);try{for(let t=0;t<e.length;t++){const n=e[t];await Mu(n)}}catch(t){Xi.error(`æ›´æ–°ä¼šè¯å¼‚å¸¸ï¼š${t.message}`)}e.length>=19&&await Du(t)}async function Mu(t){switch($a.lottery.actFollowMsg){case"del":case"delete":await function({talker_id:t,session_type:e}){return ms.post("/session_svr/v1/session_svr/remove_session",{talker_id:t,session_type:e,build:0,mobi_app:"web",csrf_token:$a.BILIJCT,csrf:$a.BILIJCT})}(t);break;case"read":await function({talker_id:t,session_type:e,ack_seqno:n}){return ms.post("/session_svr/v1/session_svr/update_ack",{talker_id:t,session_type:e,ack_seqno:n,build:0,mobi_app:"web",csrf_token:$a.BILIJCT,csrf:$a.BILIJCT},{headers:{origin:Aa}})}(t)}await Oa(50)}var Fu={taskReward:async function(){Xi.info("----ã€æ¯æ—¥ä»»åŠ¡å®Œæˆæƒ…å†µã€‘----");try{const{data:t,message:e,code:n}=await ps.get("/x/member/web/exp/reward");await Oa();const{data:r}=await bs();if(0!=n)return void Xi.warn(`çŠ¶æ€è·å–å¤±è´¥: ${n} ${e}`);const o=Ta.money-$a.BILI_STAY_COINS;let i=0;0===Ta.coinsTask?Xi.info(`ä»Šæ—¥æŠ•å¸è·å–ç»éªŒ: ${r}ï¼Œè¿˜éœ€æŠ•å¸0é¢—ï¼Œç»éªŒå¤Ÿäº†ï¼Œä¸æƒ³æŠ•äº†`):o<=0?Xi.info(`ä»Šæ—¥æŠ•å¸è·å–ç»éªŒ: ${r}ï¼Œè¿˜éœ€æŠ•å¸0é¢—ï¼Œç¡¬å¸ä¸å¤Ÿäº†ï¼Œä¸æŠ•å¸äº†`):o<Ta.coinsTask?(i=Ta.coinsTask-o,Xi.info(`æŠ•å¸è·å–ç»éªŒ: ${r}ï¼Œè¿˜éœ€æŠ•å¸æ•°é‡: ${i}é¢—;(ç›®æ ‡${Ta.coinsTask}é¢—ï¼Œå¿½ç•¥éƒ¨åˆ†æŠ•å¸)`)):(i=Ta.coinsTask-r/10,Xi.info(`æŠ•å¸è·å–ç»éªŒ: ${r}ï¼Œè¿˜éœ€æŠ•å¸æ•°é‡: ${i}é¢—;(ç›®æ ‡${Ta.coinsTask}é¢—)`)),Ta.coinsTask=i,Xi.info("æ¯æ—¥åˆ†äº«: "+(t.share?"å·²å®Œæˆ":"[æœªå®Œæˆ]")),Xi.info("æ¯æ—¥æ’­æ”¾: "+(t.watch?"å·²å®Œæˆ":"[æœªå®Œæˆ]")),Ta.share=t.share,Ta.watch=t.watch}catch(t){Xi.error(`çŠ¶æ€è·å–å¼‚å¸¸ ${t.message}`)}},liveSignTask:async function(){Xi.info("----ã€ç›´æ’­ç­¾åˆ°ã€‘----");try{const{data:t}=await ds.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===t.status)return Xi.info("å·²ç­¾åˆ°ï¼Œè·³è¿‡ç­¾åˆ°"),void Xi.info(`å·²ç»ç­¾åˆ°${t.hadSignDays}å¤©ï¼Œ${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await ds.get("/xlive/web-ucenter/v1/sign/DoSign");0===t?Xi.info(`ç›´æ’­ç­¾åˆ°æˆåŠŸ: ${e.text}ï¼Œç‰¹åˆ«ä¿¡æ¯: ${e.specialText}ï¼Œæœ¬æœˆç­¾åˆ°å¤©æ•°: ${e.hadSignDays}å¤©;`):Xi.warn(`ç›´æ’­ç­¾åˆ°å¤±è´¥: ${t} ${n}`)}catch(t){Xi.error(`ç›´æ’­ç­¾åˆ°å¼‚å¸¸: ${t.message}`)}},addCoins:async function(){if(Xi.info("----ã€è§†é¢‘æŠ•å¸ã€‘----"),!Ta.coinsTask)return void Xi.info("è·³è¿‡æŠ•å¸ï¼Œä»Šæ—¥å·²å®Œæˆ");const t={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let e=!1;for(;Ta.coinsTask&&!e&&t.eCount<5;)e=await Fs(t);t.eCount>=5&&Xi.info("å‡ºç°å¼‚å¸¸/é”™è¯¯5æ¬¡ï¼Œè‡ªåŠ¨é€€å‡ºæŠ•å¸"),Xi.info(`ä¸€å…±æˆåŠŸæŠ•å¸${t.num}é¢—`),Xi.info(`ç¡¬å¸è¿˜å‰©${Ta.money}é¢—`)},shareAndWatch:async function(){if(Xi.info("----ã€åˆ†äº«/æ’­æ”¾è§†é¢‘ã€‘----"),Ta.share&&Ta.watch)return void Xi.info("å·²å®Œæˆï¼Œè·³è¿‡åˆ†äº«/æ’­æ”¾");let t=0;try{let e=await Ds();if("-1"===e.msg&&(e=await Ls()),"0"!==e.msg)return Xi.warn(`è·å–è§†é¢‘å¤±è´¥ ${e.msg}`),!1;{const{id:n,author:r,title:o}=e.data;t=n,Xi.info(`è·å–è§†é¢‘: ${o} --upã€${r}ã€‘`)}}catch(t){return Xi.error(`è·å–è§†é¢‘å‡ºç°å¼‚å¸¸: ${t.message}`),!1}if(!Ta.share){await Oa();try{const{code:e,message:n}=await function(t){const e={csrf:$a.BILIJCT,aid:t};return ps.post("/x/web-interface/share/add",e)}(t);0===e?Xi.info("åˆ†äº«è§†é¢‘æˆåŠŸ!"):Xi.warn(`åˆ†äº«è§†é¢‘å¤±è´¥: ${e} ${n}`)}catch(t){Xi.error(`åˆ†äº«è§†é¢‘å¼‚å¸¸: ${t.message}`)}}if(!Ta.watch){await Oa();try{const{code:r,message:o}=await(e=t,n=ji(4,60),ps.post("/x/click-interface/web/heartbeat",{aid:e,played_time:n}));0===r?Xi.info("æ’­æ”¾è§†é¢‘æˆåŠŸ!"):Xi.warn(`æ’­æ”¾è§†é¢‘å¤±è´¥: ${r} ${o}`)}catch(t){Xi.error(`æ’­æ”¾è§†é¢‘å¼‚å¸¸: ${t.message}`)}}var e,n},silver2Coin:async function(){Xi.info("----ã€é“¶ç“œå­å…‘æ¢ç¡¬å¸ã€‘----");try{const{data:t,code:e,message:n}=await ds.get("/xlive/revenue/v1/wallet/getStatus");if(0!=e&&Xi.info(`è·å–ç“œå­è¯¦æƒ…å¤±è´¥ ${n}`),0===t.silver_2_coin_left)Xi.info("ä»Šæ—¥å·²å…‘æ¢ä¸€æ¬¡");else if(t.silver<700)Xi.info("å…‘æ¢å¤±è´¥ï¼Œä½ ç“œå­ä¸å¤Ÿäº†");else{const{message:t}=await ds.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:$a.BILIJCT,csrf:$a.BILIJCT});Xi.info(`å…‘æ¢ç¡¬å¸ï¼š ${t}`),await ds.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(t){Xi.error(`æ“ä½œå¼‚å¸¸ ${t.message}`)}},mangaSign:async function(){Xi.info("----ã€æ¼«ç”»ç­¾åˆ°ã€‘----"),Xi.warn("æ¼«ç”»ç­¾åˆ°ä»»åŠ¡ç§»åŠ¨åˆ°äº†æ¼«ç”»ä»»åŠ¡ä¸­ï¼Œè¯·ä¿®æ”¹ä¸ºæ–°çš„ä»»åŠ¡"),await Vs()},mangaTask:async function(){Xi.info("----ã€æ¼«ç”»ä»»åŠ¡ã€‘----");const{manga:t}=$a;try{t.sign&&(Xi.info("å¼€å§‹ç­¾åˆ°"),await Vs());t.buy&&function(){const{buyWeek:t,buyInterval:e}=$a.manga;if(!t||0===t.length)return!1;if(1===e)return!0;const n=new Date,r=n.getDay(),o=n.getDate();return t.includes(r)||o%e-1==0}()?(Xi.info("å¼€å§‹è´­ä¹°æ¼«ç”»"),await Qs()):Xi.info("éè´­ä¹°æ¼«ç”»æ—¶é—´ï¼Œä¸è´­ä¹°")}catch(t){Xi.error(`æ¼«ç”»ä»»åŠ¡å¼‚å¸¸: ${t}`)}},supGroupSign:async function(){Xi.info("----ã€åº”æ´å›¢ç­¾åˆ°ã€‘----");const t=await Xs();await Oa();let e=0;for(let o=0;o<t.length;){const i=t[o];try{const{data:t,code:o,message:a}=await(n=i.group_id,r=i.owner_uid,ms.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===o?0===t.status?e++:Xi.info(a):Xi.warn(`[${i.group_name}]ç­¾åˆ°å¤±è´¥ ${a}`)}catch(t){Xi.error(`ç­¾åˆ°å¼‚å¸¸ ${t.message}`)}finally{await Oa()}}var n,r;Xi.info(`ç­¾åˆ°ç»“æŸï¼ŒæˆåŠŸ${e}/${t.length}`)},liveSendMessage:async function(){Xi.info("----ã€å‘é€ç›´æ’­å¼¹å¹•ã€‘----"),Xi.info("è¯¥å‡½æ•°å³å°†åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ liveIntimacy æ›¿ä»£");try{const t=await Jc(),e=t.length;let n=0,r=0;Xi.info(`ä¸€å…±éœ€è¦å‘é€${e}ä¸ªç›´æ’­é—´`),Xi.verbose("æ‰€éœ€æ—¶é—´å¯èƒ½å¾ˆé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…");for(let o=0;o<e;o++){const{room_info:i,anchor_info:a,medal:s}=t[o];null!=i&&i.room_id?100===s.today_feed||s.level>=20?r++:(await Wc(i.room_id,a.nick_name)&&n++,o<e-1&&await Oa(ji(1e4,25e3))):(Xi.info(`ã€${a.nick_name}ã€‘æ²¡æœ‰ç›´æ’­é—´å“¦`),r++)}Xi.info(`æˆåŠŸå‘é€${n}ä¸ªå¼¹å¹•ï¼Œè·³è¿‡${r}ä¸ª`)}catch(t){Xi.error(`ç›´æ’­é—´å‘é€å¼¹å¹•å¼‚å¸¸: ${t.message}`)}},charging:async function(){if(Xi.info("----ã€ç»™ç›®æ ‡å……ç”µã€‘----"),await ru(),await Oa(),function(){const t=Ui(),e=t.getDate(),n=xi(t);let r=$a.charge.presetTime;return Ei(r)||(r=[r]),Ta.bCoinCouponBalance<2?(Xi.info(`å‰©ä½™åˆ¸ä¸º${Ta.bCoinCouponBalance}ï¼Œä¸è¶³2è·³è¿‡å……ç”µ`),!1):n===e?(Xi.info("ä»Šå¤©æ˜¯æœ€åä¸€å¤©äº†"),!0):!!r.some((t=>t===e))||(Xi.info("ä¸åœ¨é¢„è®¾æ—¶é—´ï¼Œä¸ç¬¦åˆæ¡ä»¶"),!1)}())try{const t=Ta.bCoinCouponBalance||0,e=$a.charge.mid;let n=0;Xi.info(`b å¸åˆ¸ä½™é¢${t}`);const r=async()=>{const{code:n,message:r,data:o}=await function(t=50,e=!0,n=$a.USERID,r="up",o=n){return ps.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:$a.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:r,oid:o})}(t,!0,e);0===n?(Xi.info(`ç›®æ ‡ã€${e}ã€‘${ou[o.status]}`),o.status===ou["æˆåŠŸ"]&&(Ta.chargeOrderNo=o.order_no,await Oa(),await async function(){try{if(!Ta.chargeOrderNo)return!1;const t=_i[ji(0,_i.length-1)],{code:e}=await function(t,e="æ”¯æŒå¤§ä½¬ä¸€æ³¢"){return ps.post("/x/ugcpay/trade/elec/message",{csrf:$a.BILIJCT,message:e,order_id:t})}(Ta.chargeOrderNo,t);0===e&&Xi.info("ç•™è¨€æˆåŠŸï¼")}catch{}}())):Xi.warn(`å……ç”µå¤±è´¥ï¼š${n} ${r}`)};for(Ta.chargeOrderNo="";!(Ta.chargeOrderNo||(await r(),await Oa(),n++>2)););}catch(t){Xi.error(`å……ç”µå‡ºç°å¼‚å¸¸ï¼š${t.message}`)}},getVipPrivilege:async function(){try{if(Xi.info("----ã€é¢†å–å¤§ä¼šå‘˜æƒç›Šã€‘----"),0===Ta.vipStatus||0===Ta.vipType)return void Xi.info("æ‚¨è¿˜ä¸æ˜¯å¤§ä¼šå‘˜ï¼Œæ— æ³•é¢†å–æƒç›Š");const t=await iu();if(!t||0===t.length)return;for(let e=0;e<t.length;e++){await Oa(100);const n=t[e];await su(n.type)}}catch(t){Xi.error(`é¢†å–å¤§ä¼šå‘˜æƒç›Šå‡ºç°å¼‚å¸¸ï¼š${t.message}`),Xi.error(t)}},matchGame:async function(){if(Xi.info("----ã€èµ›äº‹ç¡¬å¸ç«çŒœã€‘----"),$a.MATCH_COINS<=0)return void Xi.info("ç¡¬å¸æ•°é‡ä¸èƒ½å°äº 0");if(du())return;const t=await async function(){try{const{code:t,message:e,data:{list:n,page:r}}=await function(t="",e=""){return ps.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`)}();return 0!==t?void Xi.warn(`è·å–èµ›äº‹é”™è¯¯ ${t} ${e}`):0===r.total?(Xi.info("ä»Šæ—¥å·²ç»æ— æ³•è·å–èµ›äº‹"),null):n}catch(t){}}();if(await Oa(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:r}=n,o=t.id,[{id:i,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(du())return e;if(c)continue;Xi.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=$a.MATCH_SELECTION>0?l?f:u:l?u:f,Xi.info(`é¢„æµ‹[ ${d.option} ] ${$a.MATCH_COINS} é¢—ç¡¬å¸`),await Oa();const{code:p}=await lu(o,i,d.detail_id,$a.MATCH_COINS);0!==p?Xi.info("é¢„æµ‹å¤±è´¥"):(e++,Ta.money-=$a.MATCH_COINS)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:r,is_guess:o}]=n;if(o)return!1;const[i,a]=r;return Math.abs(i.odds-a.odds)>=e}))}(t,$a.MATCH_DIFF));Xi.info(`ã€ç«çŒœç»“æŸã€‘ä¸€å…±å‚ä¸${e}æ¬¡é¢„æµ‹`)},liveLottery:async function(){Xi.info("----ã€å¤©é€‰æ—¶åˆ»ã€‘----");const t=await Nu();if(!t)return t;try{const t=await pu();Xi.info(`æœ€åä¸€ä¸ªå…³æ³¨çš„UP: ${t.uname}`);const e=await async function(){Su=[];const{pageNum:t}=$a.lottery,e=await Iu();for(const n of e)for(const e of n)await Pu(e.areaId,e.parentId,t);return Su}();Xi.info("æ‰«æå®Œæˆ");const n=[];await yu(n,e,null==t?void 0:t.mid),await hu(n),Xi.info("ç§»åŠ¨å…³æ³¨UPåˆ°åˆ†ç»„æˆåŠŸ")}catch(t){Xi.warn(`å¤©é€‰æ—¶åˆ»å¼‚å¸¸: ${t.message}`),Xi.debug(t)}Xi.info("ç»“æŸå¤©é€‰æ—¶åˆ»")},liveRedPack:async function(){Xi.info("----ã€å¤©é€‰çº¢åŒ…ã€‘----");try{const t=await pu();Xi.info(`æœ€åä¸€ä¸ªå…³æ³¨çš„UP: ${t.uname}`);const e=await async function(){Su=[];const{pageNum:t}=$a.lottery,e=await Iu();for(const n of e)for(const e of n)await Au(e.areaId,e.parentId,t);return Su}();Xi.info("æ‰«æå®Œæˆï¼Œè·å–æ–°å…³æ³¨çš„UP");const n=[];await yu(n,e,null==t?void 0:t.mid),Xi.info("å¼€å§‹è¯»å–æ¶ˆæ¯"),await Du(n),Xi.info("ç§»åŠ¨å…³æ³¨UPåˆ°åˆ†ç»„"),await hu(n),Xi.info("ç§»åŠ¨å…³æ³¨UPåˆ°åˆ†ç»„æˆåŠŸ")}catch(t){Xi.warn(`å¤©é€‰æ—¶åˆ»å¼‚å¸¸: ${t.message}`),Xi.debug(t)}Xi.info("ç»“æŸå¤©é€‰çº¢åŒ…")},liveIntimacy:async function(){Xi.info("----ã€ç›´æ’­äº²å¯†åº¦ã€‘----");try{await Zc(),Xi.info("ç›´æ’­äº²å¯†åº¦å®Œæˆ")}catch(t){Xi.error(`ç›´æ’­äº²å¯†åº¦: ${t.message}`)}},giveGift:async function(){Xi.info("----ã€æŠ•å–‚è¿‡æœŸé£Ÿç‰©ã€‘----");try{const t=await uu();if(await Oa(),null==t||!t.length)return void Xi.info("æ²¡æœ‰2å¤©å†…è¿‡æœŸçš„ç®€å•ç¤¼ç‰©");const e=await async function(){const t=Object.assign([],$a.BILI_GIFT_UP),e=()=>t.splice(ji($a.BILI_GIFT_UP.length-1),1)[0];for(;t.length;){const t=e(),n=await fu(t);if(n)return{mid:t,...n}}return await async function(){const{data:{count:t,items:e}}=await function(t=1,e=10){return t>10&&(t=10),ds.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`)}();if(await Oa(),!t)return;const n=e[ji(e.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!e)return void Xi.info("æ²¡æœ‰æ‰¾åˆ°æŠ•å–‚ç›®æ ‡");await async function({roomid:t,mid:e,name:n},r){for(const o of r){await Oa();try{const{code:r,message:i,data:a}=await _s({roomid:t,ruid:e,bag_id:o.bag_id,gift_id:o.gift_id,gift_num:o.gift_num});if(0!==r){Xi.warn(`å‘[${n}]æŠ•å–‚[${o.gift_name}]ï¼Œ${i}`);continue}a.gift_list.forEach((t=>{Xi.info(`æˆåŠŸç»™ [${n}] æŠ•å–‚${t.gift_name}`)}))}catch{}}}(e,t)}catch(t){Xi.info(`æŠ•å–‚è¿‡æœŸé£Ÿç‰©å¼‚å¸¸ ${t}`)}}},Gu=Object.freeze({__proto__:null,loginTask:async function(){Xi.info("----ã€ç™»å½•ã€‘----");const{data:t,message:e,code:n}=await vs();if(0!==n)throw Xi.error(`ç™»å½•é”™è¯¯ ${n} ${e}`),new Error(e);if(!t.isLogin)throw new Error("æ¥å£è¿”å›ä¸ºæœªç™»å½•");await Oa(),await Is(t)},default:Fu}),qu=!y((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Hu=qt,zu=Q,Ku=Mt,Ju=qu,Yu=hn("IE_PROTO"),Wu=Object,Qu=Wu.prototype,Vu=Ju?Wu.getPrototypeOf:function(t){var e=Ku(t);if(Hu(e,Yu))return e[Yu];var n=e.constructor;return zu(n)&&e instanceof n?n.prototype:e instanceof Wu?Qu:null},Xu={},Zu=wr,tf=vr,ef=Object.keys||function(t){return Zu(t,tf)},nf=_,rf=Le,of=xe,af=je,sf=W,cf=ef;Xu.f=nf&&!rf?Object.defineProperties:function(t,e){af(t);for(var n,r=sf(e),o=cf(e),i=o.length,a=0;i>a;)of.f(t,n=o[a++],r[n]);return t};var uf,ff=nt("document","documentElement"),lf=je,df=Xu,pf=vr,gf=yn,mf=ff,hf=we,yf=hn("IE_PROTO"),_f=function(){},wf=function(t){return"<script>"+t+"<\/script>"},vf=function(t){t.write(wf("")),t.close();var e=t.parentWindow.Object;return t=null,e},bf=function(){try{uf=new ActiveXObject("htmlfile")}catch(t){}var t,e;bf="undefined"!=typeof document?document.domain&&uf?vf(uf):((e=hf("iframe")).style.display="none",mf.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(wf("document.F=Object")),t.close(),t.F):vf(uf);for(var n=pf.length;n--;)delete bf.prototype[pf[n]];return bf()};gf[yf]=!0;var $f=Object.create||function(t,e){var n;return null!==t?(_f.prototype=lf(t),n=new _f,_f.prototype=null,n[yf]=t):n=bf(),void 0===e?n:df.f(n,e)},Tf=Vr,Sf=rt,If=Vu,Of=uo,Cf=Ar,Ef=$f,kf=Je,Pf=k,xf=Ro,Lf=ko,Uf=Nc,Af=Oo,Rf=No,jf=ie("toStringTag"),Nf=Error,Bf=[].push,Df=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,o=Sf(Mf,this);Of?n=Of(new Nf,o?If(this):Mf):(n=o?this:Ef(Mf),kf(n,jf,"Error")),void 0!==e&&kf(n,"message",Af(e)),Rf&&kf(n,"stack",xf(n.stack,1)),Lf(n,r);var i=[];return Uf(t,Bf,{that:i}),kf(n,"errors",i),n};Of?Of(Df,Nf):Cf(Df,Nf,{name:!0});var Mf=Df.prototype=Ef(Nf.prototype,{constructor:Pf(1,Df),message:Pf(1,""),name:Pf(1,"AggregateError")});Tf({global:!0,constructor:!0,arity:2},{AggregateError:Df});var Ff=$,Gf=St,qf=nt,Hf=Zs,zf=nc,Kf=Nc;function Jf(){Xi.info("å½“å‰ç‰ˆæœ¬ã€v0.5.11886ã€‘")}Vr({target:"Promise",stat:!0},{any:function(t){var e=this,n=qf("AggregateError"),r=Hf.f(e),o=r.resolve,i=r.reject,a=zf((function(){var r=Gf(e.resolve),a=[],s=0,c=1,u=!1;Kf(t,(function(t){var f=s++,l=!1;c++,Ff(r,e,t).then((function(t){l||u||(u=!0,o(t))}),(function(t){l||u||(l=!0,a[f]=t,--c||i(new n(a,"No one promise resolved")))}))})),--c||i(new n(a,"No one promise resolved"))}));return a.error&&i(a.value),r.promise}});var Yf=Object.freeze({__proto__:null,printVersion:async function(){let t="v0.5.11886";t.includes(".")?Jf():t=void 0;try{if(t||(t="v"+(function(){try{return require("../../package.json").version}catch{}}()||function(){try{return f.readFileSync(u.resolve(__dirname,"../version.txt"),"utf8").trim()}catch{}}()),Xi.info(`å½“å‰ç‰ˆæœ¬ã€${t}ã€‘`)),!t)return;const e=await async function(){const t={timeout:6e3};try{return(await Promise.any([Ya.get("https://api.github.com/repos/KudouRan/BiliTools/releases/latest",t),Ya.get("https://gitee.com/api/v5/repos/catlair/BiliTools/releases/latest",t)])).tag_name}catch(t){return}}();e&&e!==t&&Xi.info(`å¯æ›´æ–°ï¼šæœ€æ–°ç‰ˆæœ¬ã€${e}ã€‘`)}catch{}},printStrVersion:Jf});
